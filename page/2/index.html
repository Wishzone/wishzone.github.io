<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=得意黑:300,300italic,400,400italic,700,700italic|Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"efault"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="该网站仅为机械移植">
<meta property="og:type" content="website">
<meta property="og:title" content="请移步以下网址">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="请移步以下网址">
<meta property="og:description" content="该网站仅为机械移植">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Wishzone">
<meta property="article:tag" content="STM32,FPGA,LINUX,WEB">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>请移步以下网址</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="请移步以下网址" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">请移步以下网址</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wishzone.x3322.net:10024</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Wishzone" class="github-corner" title="Wishzone GitHub" aria-label="Wishzone GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/raspberry-pico/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/raspberry-pico/" class="post-title-link" itemprop="url">Raspberry_pico</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 22:03:15" itemprop="dateCreated datePublished" datetime="2023-09-12T22:03:15+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于树莓派pico的环境搭建与开发</p>
<h1 id="Ubuntu-C-C"><a href="#Ubuntu-C-C" class="headerlink" title="Ubuntu C/C++"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Raspberry-pico/#Ubuntu-C-C"></a>Ubuntu C/C++</h1><h2 id="依赖："><a href="#依赖：" class="headerlink" title="依赖："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Raspberry-pico/#%E4%BE%9D%E8%B5%96%EF%BC%9A"></a>依赖：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cmake gcc-arm-none-eabi libnewlib-arm-none-eabi build-essential python3-tk</span><br></pre></td></tr></table></figure>
<h2 id="下载官方SDK文件"><a href="#下载官方SDK文件" class="headerlink" title="下载官方SDK文件"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Raspberry-pico/#%E4%B8%8B%E8%BD%BD-pico-sdk-%E5%92%8C-pico-examples"></a>下载官方SDK文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//下载 pico-sdk 和 pico-examples</span><br><span class="line">cd ~</span><br><span class="line">mkdir pico</span><br><span class="line">cd pico</span><br><span class="line">git clone -b master https://github.com/raspberrypi/pico-sdk.git</span><br><span class="line">cd pico-sdk</span><br><span class="line">git submodule update —init</span><br><span class="line">cd ~/pico</span><br><span class="line">git clone -b master https://github.com/raspberrypi/pico-examples.git</span><br><span class="line">//下载 pico-project-generator</span><br><span class="line">cd ~/pico</span><br><span class="line">git clone https://github.com/raspberrypi/pico-project-generator.git</span><br></pre></td></tr></table></figure>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//添加环境变量</span><br><span class="line">echo “export PICO_SDK_PATH=/home/$USER/pico/pico-sdk” &gt;&gt; .bashrc</span><br><span class="line">//安装 VSCode 插件</span><br><span class="line">code —install-extension marus25.cortex-debug</span><br><span class="line">code —install-extension ms-vscode.cmake-tools</span><br><span class="line">code —install-extension ms-vscode.cpptools</span><br></pre></td></tr></table></figure>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Raspberry-pico/#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"></a>使用方法</h2><p>cd pico-project-generator</p>
<p>./pico-progect.py —gui</p>
<p>手动生成工程</p>
<p>cd build</p>
<p>make -j(核心数) eg：make -j4</p>
<p>将uf2文件拖入pico即可</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Raspberry-pico/#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://datasheets.raspberrypi.com/pico/getting-started-with-pico.pdf">https://datasheets.raspberrypi.com/pico/getting-started-with-pico.pdf</a><br><a target="_blank" rel="noopener" href="https://datasheets.raspberrypi.com/pico/raspberry-pi-pico-c-sdk.pdf">https://datasheets.raspberrypi.com/pico/raspberry-pi-pico-c-sdk.pdf</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/hexo/" class="post-title-link" itemprop="url">Hexo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 22:02:29" itemprop="dateCreated datePublished" datetime="2023-09-12T22:02:29+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Windows/" itemprop="url" rel="index"><span itemprop="name">Windows</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于Hexo的配置与部署</p>
<h1 id="安装-Node-js-和-Git"><a href="#安装-Node-js-和-Git" class="headerlink" title="安装 Node.js 和 Git"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E5%AE%89%E8%A3%85-Node-js-%E5%92%8C-Git%E3%80%82"></a>安装 Node.js 和 Git</h1><ul>
<li>Node.js：<a href="https://link.zhihu.com/?target=https%3A//nodejs.org/zh-cn">https://<strong>nodejs.org/zh-cn</strong></a></li>
<li>Git：<a href="https://link.zhihu.com/?target=https%3A//git-scm.com/downloads">https://<strong>git-scm.com/downloads</strong></a></li>
</ul>
<h1 id="连接-Github"><a href="#连接-Github" class="headerlink" title="连接 Github"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E8%BF%9E%E6%8E%A5-Github"></a>连接 Github</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//右键 -&gt; Git Bash Here， 设置用户名和邮箱 ：</span><br><span class="line">git config --global user.name &quot;GitHub 用户名&quot;</span><br><span class="line">git config --global user.email &quot;GitHub 邮箱&quot;</span><br><span class="line">//创建 SSH 密匙</span><br><span class="line">ssh-keygen -t rsa -C &quot;GitHub 邮箱&quot;  #然后一路回车</span><br></pre></td></tr></table></figure>
<h2 id="添加密匙："><a href="#添加密匙：" class="headerlink" title="添加密匙："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E6%B7%BB%E5%8A%A0%E5%AF%86%E5%8C%99%EF%BC%9A"></a>添加密匙：</h2><p>进入 [C:\Users\用户名\.ssh] 目录（要勾选显示“隐藏的项目”），用记事本打开公钥 id_rsa.pub 文件并复制里面的内容。</p>
<p>登陆 GitHub ，点击头像，选择 Settings ，选择左边栏的 SSH and GPG keys，点击 New SSH key。</p>
<p>Title 随便取个名字，粘贴复制的 id_rsa.pub 内容到 Key 中，点击 Add SSH key 完成添加。</p>
<h2 id="验证连接："><a href="#验证连接：" class="headerlink" title="验证连接："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E9%AA%8C%E8%AF%81%E8%BF%9E%E6%8E%A5%EF%BC%9A"></a>验证连接：</h2><p>打开 Git Bash，输入 <code>ssh -T git@github.com</code> 出现 “Are you sure……”，输入 yes 回车确认。</p>
<h1 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E5%AE%89%E8%A3%85-Hexo"></a>安装 Hexo</h1><p>使用 npm 一键安装 Hexo 博客程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//打开cmd使用npm安装Hexo</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line">npm install hexo-deployer-git —save</span><br></pre></td></tr></table></figure>
<p>然后文章修改 _config.yml 文件末尾的 Deployment 部分，修改成如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy:type: gitrepository: git@github.com:用户名/用户名.github.io.gitbranch: master</span><br></pre></td></tr></table></figure>
<h1 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Hexo/#%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0"></a>发布文章</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//右键打开 Git Bash Here，创建博文：</span><br><span class="line">hexo new “My New Post”</span><br><span class="line">hexo g # 生成页面</span><br><span class="line">hexo d # 部署发布</span><br></pre></td></tr></table></figure>
<h2 id="从wordpress导入"><a href="#从wordpress导入" class="headerlink" title="从wordpress导入"></a>从wordpress导入</h2><p>首先，安装 <code>hexo-migrator-wordpress</code> 插件。</p>
<p>$ npm install hexo-migrator-wordpress —save</p>
<p>在 WordPress 仪表盘中导出数据(“Tools” → “Export” → “WordPress”)（详情参考<a target="_blank" rel="noopener" href="https://wordpress.com/zh-cn/support/export/">WP支持页面</a>）。</p>
<p>插件安装完成后，执行下列命令来迁移所有文章。<code>source</code> 可以是 WordPress 导出的文件路径或网址。</p>
<p>$ hexo migrate wordpress <source></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/rockpi4b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/rockpi4b/" class="post-title-link" itemprop="url">Rockpi4B+</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 22:01:37" itemprop="dateCreated datePublished" datetime="2023-09-12T22:01:37+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>rock4B+的设置和配置服务器的教程</p>
<h1 id="配置脚本"><a href="#配置脚本" class="headerlink" title="配置脚本"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC"></a>配置脚本</h1><p>最开始是外国源，为了提高速度，不要下载别的东西，只安装wget</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install wget</span><br></pre></td></tr></table></figure>
<h1 id="换源"><a href="#换源" class="headerlink" title="换源"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E6%8D%A2%E6%BA%90"></a>换源</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apt-transport-https ca-certificates</span><br><span class="line">sudo nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23</p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster main contrib non-free  </p>
<p># deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster main contrib non-free  </p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster-updates main contrib non-free  </p>
<p># deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster-updates main contrib non-free  </p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster-backports main contrib non-free  </p>
<p># deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian/">https://mirrors.tuna.tsinghua.edu.cn/debian/</a> buster-backports main contrib non-free  </p>
<p># deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian-security">https://mirrors.tuna.tsinghua.edu.cn/debian-security</a> buster/updates main contrib non-free  </p>
<p># # deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/debian-security">https://mirrors.tuna.tsinghua.edu.cn/debian-security</a> buster/updates main contrib non-free  </p>
<p>deb <a target="_blank" rel="noopener" href="https://security.debian.org/debian-security">https://security.debian.org/debian-security</a> buster/updates main contrib non-free  </p>
<p># deb-src <a target="_blank" rel="noopener" href="https://security.debian.org/debian-security">https://security.debian.org/debian-security</a> buster/updates main contrib non-free  </p>
<p>deb <a target="_blank" rel="noopener" href="http://apt.radxa.com/buster-testing/">http://apt.radxa.com/buster-testing/</a> buster main  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -O - apt.radxa.com/buster-testing/public.key  sudo apt-key add -</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<h1 id="装radxa硬件驱动"><a href="#装radxa硬件驱动" class="headerlink" title="装radxa硬件驱动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E8%A3%85radxa%E7%A1%AC%E4%BB%B6%E9%A9%B1%E5%8A%A8"></a>装radxa硬件驱动</h1><p>sudo apt-get install -y rockchip-overlay &amp;&amp; sudo apt-get install -y rockpi4-dtbo libmraa</p>
<h1 id="改地区"><a href="#改地区" class="headerlink" title="改地区"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E6%94%B9%E5%9C%B0%E5%8C%BA"></a>改地区</h1><p>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p>
<h1 id="安装wifi蓝牙GPU驱动"><a href="#安装wifi蓝牙GPU驱动" class="headerlink" title="安装wifi蓝牙GPU驱动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E5%AE%89%E8%A3%85wifi%E8%93%9D%E7%89%99GPU%E9%A9%B1%E5%8A%A8"></a>安装wifi蓝牙GPU驱动</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y broadcom-wifibt-firmware</span><br><span class="line">systemctl start bluetooth</span><br><span class="line">pulseaudio —start</span><br><span class="line">sudo apt install -y git gcc g++ libpng-dev libjpeg-dev pkg-config libx11-dev libdrm-dev libgbm-dev libgbm1 libudev-dev</span><br><span class="line">mkdir -p /home/rock/work</span><br><span class="line">cd /home/rock/work</span><br><span class="line">git clone https://github.com/glmark2/glmark2.git</span><br><span class="line">cd glmark2/</span><br><span class="line">./waf configure —with-flavors=drm-glesv2</span><br><span class="line">./waf build -j 4</span><br><span class="line">./waf install</span><br><span class="line">sudo apt install -y rockchip-mali-midgard14=1.6-2</span><br><span class="line">sudo apt install -y rockchip-mali-midgard-dev=1.6-2</span><br><span class="line">glmark2-es2-drm</span><br><span class="line">apt-get install golang emacs</span><br></pre></td></tr></table></figure>
<h1 id="hdmi热插拔"><a href="#hdmi热插拔" class="headerlink" title="hdmi热插拔"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#hdmi%E7%83%AD%E6%8F%92%E6%8B%94"></a>hdmi热插拔</h1><p>sudo chmod +x /usr/local/bin/drm-hotplug.sh</p>
<h1 id="超频"><a href="#超频" class="headerlink" title="超频"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E8%B6%85%E9%A2%91"></a>超频</h1><p>nano /boot/hw_intfc.conf</p>
<p>setting cpu frequency over-2GHz</p>
<p>intfc:dtoverlay=cpufreq</p>
<h1 id="wifi模式切换"><a href="#wifi模式切换" class="headerlink" title="wifi模式切换"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#wifi%E6%A8%A1%E5%BC%8F%E5%88%87%E6%8D%A2"></a>wifi模式切换</h1><p>sudo apt-get install git cmake hostapd<br>git clone <a target="_blank" rel="noopener" href="https://github.com/oblique/create_ap">https://github.com/oblique/create_ap</a><br>cd create_ap<br>sudo make install<br>wget <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/radxa/rkwifibt/master/brcm_tools/dhd_priv.c">https://raw.githubusercontent.com/radxa/rkwifibt/master/brcm_tools/dhd_priv.c</a><br>gcc dhd_priv.c -o dhd_priv<br>sudo ./dhd_priv channel 6<br>sudo ./dhd_priv monitor 1</p>
<h1 id="安装樱花frpc"><a href="#安装樱花frpc" class="headerlink" title="安装樱花frpc"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E5%AE%89%E8%A3%85%E6%A8%B1%E8%8A%B1frpc"></a>安装樱花frpc</h1><p>cd /usr/local/bin<br>sudo wget -O frpc <a target="_blank" rel="noopener" href="https://getfrp.sh/d/frpc_linux_arm64">https://getfrp.sh/d/frpc_linux_arm64</a><br>sudo chmod 755 frpc<br>ls -ls frpc<br>md5sum frpc<br>sudo mkdir -p /usr/local/etc/natfrp<br>sudo nano /etc/systemd/system/frpc@.service</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</p>
<p>[Unit]<br>Description=SakuraFrp Service<br>After=network.target  </p>
<p>[Service]<br>Type=idle<br>User=nobody<br>Restart=on-failure<br>RestartSec=60s<br>ExecStart=/usr/local/bin/frpc -f %i<br>WorkingDirectory=/usr/local/etc/natfrp  </p>
<p>[Install]<br>WantedBy=multi-user.target  </p>
<p>打开后直接crtl c退出就可以启动<br>systemctl daemon-reload<br>systemctl enable frpc@7xk345t4zdqx2d2345fsxx91svfs7e5x:7402311<br>外网ip：202.182.122.24:63979<br>frp-fly.top:63979</p>
<p>配置systemctl进行开机启动</p>
<p>创建frpc.service服务</p>
<p>sudo nano /lib/systemd/system/frpc.service</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25</p>
<p>[Unit]  </p>
<h1 id="服务描述"><a href="#服务描述" class="headerlink" title="服务描述"></a>服务描述</h1><p>Description=frpcservice  </p>
<p>After=network.targetsyslog.target  </p>
<p>Wants=network.target  </p>
<p>[Service]  </p>
<p>Type=simple  </p>
<h1 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h1><p>ExecStart=/usr/local/frpc/frpc-c/usr/local/frpc/frpc.ini  </p>
<p>[Install]  </p>
<p>WantedBy=multi-user.target  </p>
<p>重载</p>
<p>systemctl daemon-reload</p>
<h1 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81"></a>查看状态</h1><p>sudo systemctl status frpc</p>
<p>设置开机自动启动</p>
<p>sudo systemctl enable frpc</p>
<h1 id="安装并配置clash和控制面板"><a href="#安装并配置clash和控制面板" class="headerlink" title="安装并配置clash和控制面板"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEclash%E5%92%8C%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF"></a>安装并配置clash和控制面板</h1><p>wget <a target="_blank" rel="noopener" href="https://github.com/Dreamacro/clash/releases/download/v1.10.6/clash-linux-armv64-v1.14.6.gz">https://github.com/Dreamacro/clash/releases/download/v1.10.6/clash-linux-armv64-v1.14.6.gz</a><br>gunzip linux-armv64-v1.14.6.gz<br>mv linux-armv64-v1.14.6 clash<br>sudo mv clash /usr/local/bin<br>sudo chmod a+x /usr/local/bin/clash<br>mkdir ~/.config/clash<br>nano ~/.config/clash/config.yaml<br>放入配置文件即可</p>
<p>mv Country.mmdb ~/.config/clash<br>sudo nano /etc/environment</p>
<p>export http_proxy=”<a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a>“<br>export https_proxy=”<a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a>“<br>export no_proxy=”localhost, 127.0.0.1, *edu.cn”</p>
<p>sudo visudo</p>
<p>Defaults env_keep+=”http_proxy https_proxy no_proxy”</p>
<p>sudo nano /etc/apt/apt.conf.d/10proxy</p>
<p>Acquire::http::Proxy “<a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890/</a>“;</p>
<p>nano ~/.gitconfig</p>
<p>[http]<br>proxy=<a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a><br>[https]<br>proxy=<a target="_blank" rel="noopener" href="http://127.0.0.1:7890/">http://127.0.0.1:7890</a></p>
<p>crontab -e</p>
<p>@reboot /usr/local/bin/clash</p>
<p>cd ~/.config/clash<br>clash &amp;<br>git clone <a target="_blank" rel="noopener" href="https://github.com/Dreamacro/clash-dashboard.git">https://github.com/Dreamacro/clash-dashboard.git</a><br>cd ~/.config/clash/clash-dashboard<br>git checkout -b gh-pages origin/gh-pages<br>nano ~/.config/clash/config.yaml<br>头部添加：</p>
<p>external-ui: clash-dashboard<br>external-controller: 127.0.0.1:9090</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9090/ui">http://127.0.0.1:9090/ui</a></p>
<h1 id="桌面"><a href="#桌面" class="headerlink" title="桌面"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E6%A1%8C%E9%9D%A2"></a>桌面</h1><p>sudo apt install xfce4 xorg xrdp xorgxrdp<br>touch ~/.xsession<br>echo xfce4-session &gt;~/.xsession<br>sudo chown rock:rock ~/.xsession</p>
<h1 id="改中文"><a href="#改中文" class="headerlink" title="改中文"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#%E6%94%B9%E4%B8%AD%E6%96%87"></a>改中文</h1><p>sudo apt install fcitx5 locales fonts-noto-cjk fonts-noto-cjk-extra<br>sudo dpkg-reconfigure locales<br>sudo apt-get install chromium-l10n</p>
<h1 id="Docker-运行openwrt"><a href="#Docker-运行openwrt" class="headerlink" title="Docker 运行openwrt"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/Rockpi4B+/#Docker-%E8%BF%90%E8%A1%8Copenwrt"></a>Docker 运行openwrt</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 666 /var/run/docker.sock</span><br><span class="line">sudo ip link set eth0 promisc on</span><br><span class="line"></span><br><span class="line">sudo nano /etc/rc.local</span><br></pre></td></tr></table></figure>
<p>1</p>
<p>ip link set eth0 promisc on &amp;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d macvlan —subnet=192.168.1.0/24 —gateway=192.168.1.1 -o parent=eth0 macnet</span><br><span class="line">docker network list</span><br><span class="line">mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">nano /etc/systemd/system/docker.service.d/http-proxy.conf</span><br></pre></td></tr></table></figure>
<p>1<br>2<br>3<br>4</p>
<p>[Service]<br>Environment=”HTTP_PROXY=<a href="http://proxy-addr:proxy-port">http://proxy-addr:proxy-port</a>“ #代理服务器地址<br>Environment=”HTTPS_PROXY=<a href="http://proxy-addr:proxy-port">http://proxy-addr:proxy-port</a>“ #https<br>Environment=”NO_PROXY=localhost,127.0.0.0/8,docker-registry.example.com,.corp” #哪些地址不需要走代理</p>
<p>systemctl daemon-reload<br>systemctl restart docker<br>sudo systemctl show —property=Environment docker<br>docker run —restart always —name openwrt -d —network macnet —privileged sulinggg/openwrt:armv8 /sbin/init<br>docker ps -a<br>docker exec -it d61d5edd67d4 bash<br>vim /etc/config/network<br>将后面三项改成自己的ip</p>
<p>/etc/init.d/network restart</p>
<p>直接浏览器访问刚刚设置的ip和端口<br>密码默认passwd</p>
<p>在网络LAN口中关闭桥接接口</p>
<p>网络防火墙自定义规则中添加<br>iptables -t nat -I POSTROUTING -j MASQUERADE</p>
<p>在网络Turbo ACC网络加速中勾选DNS缓存</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/rt-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/rt-thread/" class="post-title-link" itemprop="url">RT-Thread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 22:01:11" itemprop="dateCreated datePublished" datetime="2023-09-12T22:01:11+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> 发表于 2023-06-24   分类于 <a target="_blank" rel="noopener" href="https://wishzone.ltd/categories/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a></p>
<p>记录自己学习RT-Thread的过程</p>
<h1 id="RT-Thread版本"><a href="#RT-Thread版本" class="headerlink" title="RT-Thread版本"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#RT-Thread%E7%89%88%E6%9C%AC"></a>RT-Thread版本</h1><h2 id="标准版"><a href="#标准版" class="headerlink" title="标准版"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%A0%87%E5%87%86%E7%89%88"></a>标准版</h2><p>包含内核，组件和服务，上层应用包</p>
<h2 id="Nano版"><a href="#Nano版" class="headerlink" title="Nano版"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#Nano%E7%89%88"></a>Nano版</h2><p>包含内核，可移植组件</p>
<h2 id="Smart版"><a href="#Smart版" class="headerlink" title="Smart版"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#Smart%E7%89%88"></a>Smart版</h2><p>将硬件层与软件层分开，类似Linux</p>
<h1 id="内核"><a href="#内核" class="headerlink" title="内核"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%86%85%E6%A0%B8"></a>内核</h1><p>负责线程管理thread.c，时钟管理clock.c,timer.c，中断管理，内存管理mem.c,memheap.c等，以及线程之间的同步与通信ipc.c,对象管理object.c,实时调度器schedule.c，设备管理device.c</p>
<h1 id="内核启动"><a href="#内核启动" class="headerlink" title="内核启动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%86%85%E6%A0%B8%E5%90%AF%E5%8A%A8"></a>内核启动</h1><h2 id="汇编启动"><a href="#汇编启动" class="headerlink" title="汇编启动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%B1%87%E7%BC%96%E5%90%AF%E5%8A%A8"></a>汇编启动</h2><p>Reset_Handler—&gt;LoopCopyDataInit—&gt;LoopFillZerobss—&gt;SystemInit()</p>
<h2 id="C文件启动"><a href="#C文件启动" class="headerlink" title="C文件启动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#C%E6%96%87%E4%BB%B6%E5%90%AF%E5%8A%A8"></a>C文件启动</h2><p>SystemInit()—&gt;__libc_init_array()—&gt;entry()—&gt;rtthread_startup()</p>
<h2 id="系统启动"><a href="#系统启动" class="headerlink" title="系统启动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8"></a>系统启动</h2><p>rtthread启动过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">intrtthread_startup(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">rt_hw_interrupt_disable();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*板级初始化：需在该函数内部进行系统堆的初始化*/</span><br><span class="line"></span><br><span class="line">rt_hw_board_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*打印RT-Thread版本信息*/</span><br><span class="line"></span><br><span class="line">rt_show_version();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*定时器初始化*/</span><br><span class="line"></span><br><span class="line">rt_system_timer_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*调度器初始化*/</span><br><span class="line"></span><br><span class="line">rt_system_scheduler_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ifdef RT_USING_SIGNALS</span><br><span class="line"></span><br><span class="line">/*信号初始化*/</span><br><span class="line"></span><br><span class="line">rt_system_signal_init();</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*由此创建一个用户main线程mian_thread_entry*/</span><br><span class="line"></span><br><span class="line">rt_application_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*定时器线程初始化创建线程rt_thread_timer_entry*/</span><br><span class="line"></span><br><span class="line">rt_system_timer_thread_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*空闲线程初始化创建线程rt_thread_idle_entry*/</span><br><span class="line"></span><br><span class="line">rt_thread_idle_init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*启动调度器*/</span><br><span class="line"></span><br><span class="line">rt_system_scheduler_start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*不会执行至此*/</span><br><span class="line"></span><br><span class="line">return0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="线程启动"><a href="#线程启动" class="headerlink" title="线程启动"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E5%90%AF%E5%8A%A8"></a>线程启动</h2><p>首先在系统启动的时候就已经创建了三个线程：</p>
<p>mian_thread_entry</p>
<p>rt_thread_timer_entry</p>
<p>rt_thread_idle_entry</p>
<h3 id="rt-application-init"><a href="#rt-application-init" class="headerlink" title="rt_application_init()"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#rt-application-init"></a>rt_application_init()</h3><h4 id="线程创建"><a href="#线程创建" class="headerlink" title="线程创建"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA"></a>线程创建</h4><p>根据是否使用堆会有两种创建方式:</p>
<h5 id="使用堆heap"><a href="#使用堆heap" class="headerlink" title="使用堆heap"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E4%BD%BF%E7%94%A8%E5%A0%86heap"></a>使用堆heap</h5><p>1<br>2<br>3<br>4<br>5</p>
<p>rt_thread_create(“main”, main_thread_entry, RT_NULL,  </p>
<p>RT_MAIN_THREAD_STACK_SIZE, RT_MAIN_THREAD_PRIORITY, 20);  </p>
<p>动态调度方式创建</p>
<h5 id="不使用堆heap"><a href="#不使用堆heap" class="headerlink" title="不使用堆heap"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%A0%86heap"></a>不使用堆heap</h5><p>1<br>2<br>3<br>4<br>5</p>
<p>rt_thread_init(tid, “main”, main_thread_entry, RT_NULL,  </p>
<p>main_stack, sizeof(main_stack), RT_MAIN_THREAD_PRIORITY, 20);  </p>
<p>静态创建</p>
<h4 id="进入线程启动器函数启动线程"><a href="#进入线程启动器函数启动线程" class="headerlink" title="进入线程启动器函数启动线程"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E8%BF%9B%E5%85%A5%E7%BA%BF%E7%A8%8B%E5%90%AF%E5%8A%A8%E5%99%A8%E5%87%BD%E6%95%B0%E5%90%AF%E5%8A%A8%E7%BA%BF%E7%A8%8B"></a>进入线程启动器函数启动线程</h4><p>rt_thread_startup(tid)</p>
<h4 id="进入就绪状态并运行线程"><a href="#进入就绪状态并运行线程" class="headerlink" title="进入就绪状态并运行线程"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E8%BF%9B%E5%85%A5%E5%B0%B1%E7%BB%AA%E7%8A%B6%E6%80%81%E5%B9%B6%E8%BF%90%E8%A1%8C%E7%BA%BF%E7%A8%8B"></a>进入就绪状态并运行线程</h4><p>main_thread_entry()</p>
<h4 id="线程进入主函数"><a href="#线程进入主函数" class="headerlink" title="线程进入主函数"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E8%BF%9B%E5%85%A5%E4%B8%BB%E5%87%BD%E6%95%B0"></a>线程进入主函数</h4><p>main()</p>
<h3 id="rt-thread-timer-entry"><a href="#rt-thread-timer-entry" class="headerlink" title="rt_thread_timer_entry()"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#rt-thread-timer-entry"></a>rt_thread_timer_entry()</h3><h3 id="rt-thread-idle-entry"><a href="#rt-thread-idle-entry" class="headerlink" title="rt_thread_idle_entry()"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#rt-thread-idle-entry"></a>rt_thread_idle_entry()</h3><p>退出线程,cleanup函数清理资源</p>
<h2 id="用户线程的创建"><a href="#用户线程的创建" class="headerlink" title="用户线程的创建"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%94%A8%E6%88%B7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"></a>用户线程的创建</h2><h3 id="线程结构体-线程控制块"><a href="#线程结构体-线程控制块" class="headerlink" title="线程结构体(线程控制块)"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E7%BB%93%E6%9E%84%E4%BD%93-%E7%BA%BF%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97"></a>线程结构体(线程控制块)</h3><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br>106<br>107<br>108<br>109<br>110<br>111<br>112<br>113<br>114<br>115<br>116<br>117<br>118<br>119<br>120<br>121<br>122<br>123<br>124<br>125<br>126<br>127<br>128<br>129<br>130<br>131<br>132<br>133<br>134<br>135<br>136<br>137<br>138<br>139<br>140<br>141<br>142</p>
<p>struct rt_thread  </p>
<p>{  </p>
<p>/* rt object */  </p>
<p>char name[RT_NAME_MAX]; /**&lt; the name of thread */  </p>
<p>rt_uint8_t type; /**&lt; type of object */  </p>
<p>rt_uint8_t flags; /**&lt; thread’s flags */  </p>
<h1 id="ifdef-RT-USING-MODULE"><a href="#ifdef-RT-USING-MODULE" class="headerlink" title="ifdef RT_USING_MODULE"></a>ifdef RT_USING_MODULE</h1><p>void *module_id; /**&lt; id of application module */  </p>
<h1 id="endif"><a href="#endif" class="headerlink" title="endif"></a>endif</h1><p>rt_list_t list; /**&lt; the object list */  </p>
<p>rt_list_t tlist; /**&lt; the thread list */  </p>
<p>/* stack point and entry */  </p>
<p>void *sp; /**&lt; stack point */  </p>
<p>void *entry; /**&lt; entry */  </p>
<p>void *parameter; /**&lt; parameter */  </p>
<p>void *stack_addr; /**&lt; stack address */  </p>
<p>rt_uint32_t stack_size; /**&lt; stack size */  </p>
<p>/* error code */  </p>
<p>rt_err_t error; /**&lt; error code */  </p>
<p>rt_uint8_t stat; /**&lt; thread status */  </p>
<h1 id="ifdef-RT-USING-SMP-判断是否使用多核"><a href="#ifdef-RT-USING-SMP-判断是否使用多核" class="headerlink" title="ifdef RT_USING_SMP //判断是否使用多核"></a>ifdef RT_USING_SMP //判断是否使用多核</h1><p>rt_uint8_t bind_cpu; /**&lt; thread is bind to cpu */  </p>
<p>rt_uint8_t oncpu; /**&lt; process on cpu` */  </p>
<p>rt_uint16_t scheduler_lock_nest; /**&lt; scheduler lock count */  </p>
<p>rt_uint16_t cpus_lock_nest; /**&lt; cpus lock count */  </p>
<p>rt_uint16_t critical_lock_nest; /**&lt; critical lock count */  </p>
<h1 id="endif-RT-USING-SMP"><a href="#endif-RT-USING-SMP" class="headerlink" title="endif /*RT_USING_SMP*/"></a>endif /*RT_USING_SMP*/</h1><p>/* priority */  </p>
<p>rt_uint8_t current_priority; /**&lt; current priority */  </p>
<p>rt_uint8_t init_priority; /**&lt; initialized priority */  </p>
<h1 id="if-RT-THREAD-PRIORITY-MAX-gt-32"><a href="#if-RT-THREAD-PRIORITY-MAX-gt-32" class="headerlink" title="if RT_THREAD_PRIORITY_MAX &gt;32"></a>if RT_THREAD_PRIORITY_MAX &gt;32</h1><p>rt_uint8_t number;  </p>
<p>rt_uint8_t high_mask;  </p>
<h1 id="endif-1"><a href="#endif-1" class="headerlink" title="endif"></a>endif</h1><p>rt_uint32_t number_mask;  </p>
<h1 id="ifdefined-RT-USING-EVENT"><a href="#ifdefined-RT-USING-EVENT" class="headerlink" title="ifdefined(RT_USING_EVENT)"></a>ifdefined(RT_USING_EVENT)</h1><p>/* thread event */  </p>
<p>rt_uint32_t event_set;  </p>
<p>rt_uint8_t event_info;  </p>
<h1 id="endif-2"><a href="#endif-2" class="headerlink" title="endif"></a>endif</h1><h1 id="ifdefined-RT-USING-SIGNALS"><a href="#ifdefined-RT-USING-SIGNALS" class="headerlink" title="ifdefined(RT_USING_SIGNALS)"></a>ifdefined(RT_USING_SIGNALS)</h1><p>rt_sigset_t sig_pending; /**&lt; the pending signals */  </p>
<p>rt_sigset_t sig_mask; /**&lt; the mask bits of signal */  </p>
<h1 id="ifndef-RT-USING-SMP"><a href="#ifndef-RT-USING-SMP" class="headerlink" title="ifndef RT_USING_SMP"></a>ifndef RT_USING_SMP</h1><p>void *sig_ret; /**&lt; the return stack pointer from signal */  </p>
<h1 id="endif-3"><a href="#endif-3" class="headerlink" title="endif"></a>endif</h1><p>rt_sighandler_t *sig_vectors; /**&lt; vectors of signal handler */  </p>
<p>void *si_list; /**&lt; the signal infor list */  </p>
<h1 id="endif-4"><a href="#endif-4" class="headerlink" title="endif"></a>endif</h1><p>rt_ubase_t init_tick; /**&lt; thread’s initialized tick */  </p>
<p>rt_ubase_t remaining_tick; /**&lt; remaining tick */  </p>
<h1 id="ifdef-RT-USING-CPU-USAGE"><a href="#ifdef-RT-USING-CPU-USAGE" class="headerlink" title="ifdef RT_USING_CPU_USAGE"></a>ifdef RT_USING_CPU_USAGE</h1><p>rt_uint64_t duration_tick; /**&lt; cpu usage tick */  </p>
<h1 id="endif-5"><a href="#endif-5" class="headerlink" title="endif"></a>endif</h1><p>struct rt_timer thread_timer; /**&lt; built-in thread timer */  </p>
<p>void (*cleanup)(struct rt_thread *tid); /**&lt; cleanup function when thread exit */  </p>
<p>/* light weight process if present */  </p>
<h1 id="ifdef-RT-USING-LWP"><a href="#ifdef-RT-USING-LWP" class="headerlink" title="ifdef RT_USING_LWP"></a>ifdef RT_USING_LWP</h1><p>void *lwp;  </p>
<h1 id="endif-6"><a href="#endif-6" class="headerlink" title="endif"></a>endif</h1><p>rt_ubase_t user_data; /**&lt; private user data beyond this thread */  </p>
<p>};  </p>
<h3 id="线程属性"><a href="#线程属性" class="headerlink" title="线程属性"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7"></a>线程属性</h3><h4 id="线程栈"><a href="#线程栈" class="headerlink" title="线程栈"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E6%A0%88"></a>线程栈</h4><h4 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81"></a>线程状态</h4><h5 id="初始状态"><a href="#初始状态" class="headerlink" title="初始状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81"></a>初始状态</h5><p>当线程刚开始创建还没开始运行时就处于初始状态；在初始状态下，线程不参与调度。此状态在 RT-Thread 中的宏定义为 RT_THREAD_INIT</p>
<h5 id="就绪状态"><a href="#就绪状态" class="headerlink" title="就绪状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%B0%B1%E7%BB%AA%E7%8A%B6%E6%80%81"></a>就绪状态</h5><p>在就绪状态下，线程按照优先级排队，等待被执行；一旦当前线程运行完毕让出处理器，操作系统会马上寻找最高优先级的就绪态线程运行。此状态在 RT-Thread 中的宏定义为 RT_THREAD_READY</p>
<h5 id="运行状态"><a href="#运行状态" class="headerlink" title="运行状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81"></a>运行状态</h5><p>线程当前正在运行。在单核系统中，只有 rt_thread_self() 函数返回的线程处于运行状态；在多核系统中，可能就不止这一个线程处于运行状态。此状态在 RT-Thread 中的宏定义为 RT_THREAD_RUNNING</p>
<h5 id="挂起状态"><a href="#挂起状态" class="headerlink" title="挂起状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%8C%82%E8%B5%B7%E7%8A%B6%E6%80%81"></a>挂起状态</h5><p>也称阻塞态。它可能因为资源不可用而挂起等待，或线程主动延时一段时间而挂起。在挂起状态下，线程不参与调度。此状态在 RT-Thread 中的宏定义为 RT_THREAD_SUSPEND</p>
<h5 id="关闭状态"><a href="#关闭状态" class="headerlink" title="关闭状态"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%85%B3%E9%97%AD%E7%8A%B6%E6%80%81"></a>关闭状态</h5><p>当线程运行结束时将处于关闭状态。关闭状态的线程不参与线程的调度。此状态在 RT-Thread 中的宏定义为 RT_THREAD_CLOSE</p>
<h4 id="时间片"><a href="#时间片" class="headerlink" title="时间片"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%97%B6%E9%97%B4%E7%89%87"></a>时间片</h4><p>如果线程优先级相同则通过时间片,一个线程运行几个时钟周期再切换给另一个</p>
<h3 id="线程状态切换"><a href="#线程状态切换" class="headerlink" title="线程状态切换"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2"></a>线程状态切换</h3><p><img src="https://www.rt-thread.org/document/site/rt-thread-version/rt-thread-standard/programming-manual/thread/figures/04thread_sta.png" alt="Alt text"></p>
<h3 id="线程操作"><a href="#线程操作" class="headerlink" title="线程操作"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C"></a>线程操作</h3><h4 id="线程创建与删除"><a href="#线程创建与删除" class="headerlink" title="线程创建与删除"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%A0%E9%99%A4"></a>线程创建与删除</h4><p>动态创建:系统分配栈与句柄</p>
<p>静态创建:用户自行分配栈和句柄</p>
<h5 id="线程的创建"><a href="#线程的创建" class="headerlink" title="线程的创建"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"></a>线程的创建</h5><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</p>
<p>rt_thread_create(constchar *name,//名字  </p>
<p>void (*entry)(void *parameter),//线程函数入口  </p>
<p>void *parameter,//传递给线程函数的参数  </p>
<p>rt_uint32_tstack_size,//线程栈大小  </p>
<p>rt_uint8_t priority,//优先级,stm32为32个  </p>
<p>rt_uint32_ttick);//时间片节拍数量  </p>
<p>返回值为rt_thread_t,为结构体指针,返回线程控制块</p>
<h5 id="线程的删除"><a href="#线程的删除" class="headerlink" title="线程的删除"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%A0%E9%99%A4"></a>线程的删除</h5><p>rt_thread_delete(rt_thread_t thread);</p>
<p>返回值为rt_err_t,线程错误码</p>
<h2 id="RT-Thread程序内存分布"><a href="#RT-Thread程序内存分布" class="headerlink" title="RT_Thread程序内存分布"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#RT-Thread%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83"></a>RT_Thread程序内存分布</h2><p>一般 MCU 包含的存储空间有：片内 Flash 与片内 RAM，RAM 相当于内存，Flash 相当于硬盘。编译器会将一个程序分类为好几个部分，分别存储在 MCU 不同的存储区。</p>
<p>Keil 工程在编译完之后，会有相应的程序所占用的空间提示信息，如下所示：</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11</p>
<p>linking…  </p>
<p>Program Size: Code=48008 RO-data=5660 RW-data=604 ZI-data=2124  </p>
<p>After Build - User command \#1: fromelf —bin.\\build\\rtthread-stm32.axf—output rtthread.bin  </p>
<p>“.\\build\\rtthread-stm32.axf” - 0Error(s), 0Warning(s).  </p>
<p>Build Time Elapsed: 00:00:07  </p>
<p>上面提到的 Program Size 包含以下几个部分：</p>
<p>1）Code：代码段，存放程序的代码部分；</p>
<p>2）RO-data：只读数据段，存放程序中定义的常量；</p>
<p>3）RW-data：读写数据段，存放初始化为非 0 值的全局变量；</p>
<p>4）ZI-data：0 数据段，存放未初始化的全局变量及初始化为 0 的变量；</p>
<p>编译完工程会生成一个. map 的文件，该文件说明了各个函数占用的尺寸和地址，在文件的最后几行也说明了上面几个字段的关系：</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>Total RO Size (Code + RO Data) 53668 ( 52.41kB)  </p>
<p>Total RW Size (RW Data + ZI Data) 2728 ( 2.66kB)  </p>
<p>Total ROM Size (Code + RO Data + RW Data) 53780 ( 52.52kB)  </p>
<p>1）RO Size 包含了 Code 及 RO-data，表示程序占用 Flash 空间的大小；</p>
<p>2）RW Size 包含了 RW-data 及 ZI-data，表示运行时占用的 RAM 的大小；</p>
<p>3）ROM Size 包含了 Code、RO-data 以及 RW-data，表示烧写程序所占用的 Flash 空间的大小；</p>
<h2 id="RT-Thread-自动初始化机制"><a href="#RT-Thread-自动初始化机制" class="headerlink" title="RT-Thread 自动初始化机制"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#RT-Thread-%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9C%BA%E5%88%B6"></a>RT-Thread 自动初始化机制</h2><p>INIT_BOARD_EXPORT(rt_hw_usart_init); / <em>使用组件自动初始化机制</em> /</p>
<h1 id="IO设备"><a href="#IO设备" class="headerlink" title="IO设备"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#IO%E8%AE%BE%E5%A4%87"></a>IO设备</h1><p><img src="https://www.rt-thread.org/document/site/rt-thread-version/rt-thread-standard/programming-manual/device/figures/io-dev.png" alt="Alt text"></p>
<p><img src="https://www.rt-thread.org/document/site/rt-thread-version/rt-thread-standard/programming-manual/device/figures/io-fun-call.png" alt="Alt text"></p>
<p><img src="https://www.rt-thread.org/document/site/rt-thread-version/rt-thread-standard/programming-manual/device/figures/io-dev-ex.png" alt="Alt text"></p>
<h2 id="创建设备"><a href="#创建设备" class="headerlink" title="创建设备"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E5%88%9B%E5%BB%BA%E8%AE%BE%E5%A4%87"></a>创建设备</h2><h2 id="注册设备"><a href="#注册设备" class="headerlink" title="注册设备"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%B3%A8%E5%86%8C%E8%AE%BE%E5%A4%87"></a>注册设备</h2><h2 id="访问设备"><a href="#访问设备" class="headerlink" title="访问设备"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E8%AE%BF%E9%97%AE%E8%AE%BE%E5%A4%87"></a>访问设备</h2><h1 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"></a>文件结构</h1><h2 id="applications应用层"><a href="#applications应用层" class="headerlink" title="applications应用层"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#applications%E5%BA%94%E7%94%A8%E5%B1%82"></a>applications应用层</h2><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#Debug"></a>Debug</h2><h2 id="drivers驱动层"><a href="#drivers驱动层" class="headerlink" title="drivers驱动层"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#drivers%E9%A9%B1%E5%8A%A8%E5%B1%82"></a>drivers驱动层</h2><h2 id="libraries芯片硬件层"><a href="#libraries芯片硬件层" class="headerlink" title="libraries芯片硬件层"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#libraries%E8%8A%AF%E7%89%87%E7%A1%AC%E4%BB%B6%E5%B1%82"></a>libraries芯片硬件层</h2><p>包含有Hal库驱动和CMSIS等</p>
<h2 id="rt-thread系统层"><a href="#rt-thread系统层" class="headerlink" title="rt_thread系统层"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#rt-thread%E7%B3%BB%E7%BB%9F%E5%B1%82"></a>rt_thread系统层</h2><h2 id="packages"><a href="#packages" class="headerlink" title="packages"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/06/24/RT-Thread/#packages"></a>packages</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/pve/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/pve/" class="post-title-link" itemprop="url">PVE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 22:00:12" itemprop="dateCreated datePublished" datetime="2023-09-12T22:00:12+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>PVE的一部分配置</p>
<h1 id="PVE-使用无线网卡上网"><a href="#PVE-使用无线网卡上网" class="headerlink" title="PVE 使用无线网卡上网"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#PVE-%E4%BD%BF%E7%94%A8%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E4%B8%8A%E7%BD%91"></a>PVE 使用无线网卡上网</h1><h2 id="查询网卡是否识别"><a href="#查询网卡是否识别" class="headerlink" title="查询网卡是否识别"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E6%9F%A5%E8%AF%A2%E7%BD%91%E5%8D%A1%E6%98%AF%E5%90%A6%E8%AF%86%E5%88%AB"></a>查询网卡是否识别</h2><p>1<br>2</p>
<p>ip addr<br>在输出的信息中查看是否包含 w 开头的网卡</p>
<h2 id="安装并配置WiFi管理工具"><a href="#安装并配置WiFi管理工具" class="headerlink" title="安装并配置WiFi管理工具"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEWiFi%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"></a>安装并配置WiFi管理工具</h2><p>以iwd为例</p>
<p>1<br>2<br>3<br>4<br>5</p>
<h1 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h1><p>apt install iwd  </p>
<h1 id="启动-iwd-，并设置开机启动"><a href="#启动-iwd-，并设置开机启动" class="headerlink" title="启动 iwd ，并设置开机启动"></a>启动 iwd ，并设置开机启动</h1><p>systemctl start iwd<br>systemctl enable iwd</p>
<h2 id="查看无线网卡"><a href="#查看无线网卡" class="headerlink" title="查看无线网卡"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E6%9F%A5%E7%9C%8B%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1"></a>查看无线网卡</h2><p>1</p>
<p>iwctl device list</p>
<h2 id="扫描并获取无线网络"><a href="#扫描并获取无线网络" class="headerlink" title="扫描并获取无线网络"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E6%89%AB%E6%8F%8F%E5%B9%B6%E8%8E%B7%E5%8F%96%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C"></a>扫描并获取无线网络</h2><p>1<br>2</p>
<p>iwctl station wlan0 scan<br>iwctl station wlan0 get-networks</p>
<h2 id="连接无线网"><a href="#连接无线网" class="headerlink" title="连接无线网"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%BF%9E%E6%8E%A5%E6%97%A0%E7%BA%BF%E7%BD%91"></a>连接无线网</h2><p>1</p>
<p>iwctl —passphrase 密码 station 网卡 connect SSID</p>
<h2 id="安装并配置-DHCP-为虚拟机自动分配IP"><a href="#安装并配置-DHCP-为虚拟机自动分配IP" class="headerlink" title="安装并配置 DHCP 为虚拟机自动分配IP"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE-DHCP-%E4%B8%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%88%86%E9%85%8DIP"></a>安装并配置 DHCP 为虚拟机自动分配IP</h2><p>以dnsmasq为例</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>apt install dnsmasq<br># 修改配置文件 /etc/dnsmasq.conf<br># 为vmbr0网卡自动分配IP，从100-254，租约72小时<br>interface=vmbr0<br>dhcp-range=10.10.10.100,10.10.10.254,255.255.255.0,72h<br># 设置开机启动<br>systemctl enable dnsmasq</p>
<h2 id="配置网络让路由器下的其它设备能连上pve和虚拟机"><a href="#配置网络让路由器下的其它设备能连上pve和虚拟机" class="headerlink" title="配置网络让路由器下的其它设备能连上pve和虚拟机"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E8%AE%A9%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%8B%E7%9A%84%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E8%83%BD%E8%BF%9E%E4%B8%8Apve%E5%92%8C%E8%99%9A%E6%8B%9F%E6%9C%BA"></a>配置网络让路由器下的其它设备能连上pve和虚拟机</h2><h3 id="编辑配置文件-etc-network-interfaces"><a href="#编辑配置文件-etc-network-interfaces" class="headerlink" title="编辑配置文件 /etc/network/interfaces"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-network-interfaces"></a>编辑配置文件 /etc/network/interfaces</h3><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19</p>
<p>auto lo<br>iface lo inet loopback<br># 设置无线网卡静态IP<br>auto wlan0<br>iface wlan0 inet static<br>address 192.168.31.2/24<br>gateway 192.168.31.1  </p>
<p>iface enp6s0 inet manual<br># 设置 NAT<br>auto vmbr0<br>iface vmbr0 inet static<br>address 10.10.10.1/24<br>bridge-ports enp6s0<br>bridge-stp off<br>bridge-fd 0  </p>
<p>post-up echo 1 &gt; /proc/sys/net/ipv4/ip_forward # 开启IP转发<br>post-up bash /root/iptables.config.sh # 定义规则</p>
<h3 id="修改-root-iptables-config-sh"><a href="#修改-root-iptables-config-sh" class="headerlink" title="修改 /root/iptables.config.sh"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E4%BF%AE%E6%94%B9-root-iptables-config-sh"></a>修改 /root/iptables.config.sh</h3><p>1<br>2<br>3<br>4</p>
<h1 id="usr-bin-env-bash"><a href="#usr-bin-env-bash" class="headerlink" title="!/usr/bin/env bash"></a>!/usr/bin/env bash</h1><h1 id="设置NAT，让10-10-10-0-24的数据走wlan0网卡"><a href="#设置NAT，让10-10-10-0-24的数据走wlan0网卡" class="headerlink" title="设置NAT，让10.10.10.0/24的数据走wlan0网卡"></a>设置NAT，让10.10.10.0/24的数据走wlan0网卡</h1><p>iptables -t nat -A POSTROUTING -s ‘10.10.10.0/24’ -o wlan0 -j MASQUERADE<br>iptables -t raw -I PREROUTING -i fwbr+ -j CT —zone 1</p>
<h3 id="设置端口转发-让路由器下的设备能访问到虚拟机"><a href="#设置端口转发-让路由器下的设备能访问到虚拟机" class="headerlink" title="设置端口转发, 让路由器下的设备能访问到虚拟机"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%AE%BE%E7%BD%AE%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E8%AE%A9%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%8B%E7%9A%84%E8%AE%BE%E5%A4%87%E8%83%BD%E8%AE%BF%E9%97%AE%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA"></a>设置端口转发, 让路由器下的设备能访问到虚拟机</h3><h3 id="把访问-192-168-31-2-指定端口的流量转发到虚拟机对应的IP"><a href="#把访问-192-168-31-2-指定端口的流量转发到虚拟机对应的IP" class="headerlink" title="把访问 192.168.31.2 指定端口的流量转发到虚拟机对应的IP"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E6%8A%8A%E8%AE%BF%E9%97%AE-192-168-31-2-%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3%E7%9A%84%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AF%B9%E5%BA%94%E7%9A%84IP"></a>把访问 192.168.31.2 指定端口的流量转发到虚拟机对应的IP</h3><p>1<br>2</p>
<p>iptables -t nat -A PREROUTING -i wlan0 -p tcp —dport 8006 -j DNAT —to-destination 10.10.10.1:8006<br>iptables -t nat -A PREROUTING -i wlan0 -p tcp —dport 10100 -j DNAT —to-destination 10.10.10.100:80</p>
<h3 id="设置默认路由，将所有未知目的地的数据包发送到-wlan0-网络接口上，并将它们的下一跳设置为-192-168-31-1"><a href="#设置默认路由，将所有未知目的地的数据包发送到-wlan0-网络接口上，并将它们的下一跳设置为-192-168-31-1" class="headerlink" title="设置默认路由，将所有未知目的地的数据包发送到 wlan0 网络接口上，并将它们的下一跳设置为 192.168.31.1"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%EF%BC%8C%E5%B0%86%E6%89%80%E6%9C%89%E6%9C%AA%E7%9F%A5%E7%9B%AE%E7%9A%84%E5%9C%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E5%88%B0-wlan0-%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E4%B8%8A%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%AE%83%E4%BB%AC%E7%9A%84%E4%B8%8B%E4%B8%80%E8%B7%B3%E8%AE%BE%E7%BD%AE%E4%B8%BA-192-168-31-1"></a>设置默认路由，将所有未知目的地的数据包发送到 wlan0 网络接口上，并将它们的下一跳设置为 192.168.31.1</h3><p>1<br>2</p>
<p>ip route add default via 192.168.31.1 dev wlan0<br>ip route flush cache</p>
<h1 id="PVE监测温度"><a href="#PVE监测温度" class="headerlink" title="PVE监测温度"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#PVE%E7%9B%91%E6%B5%8B%E6%B8%A9%E5%BA%A6"></a>PVE监测温度</h1><h2 id="安装并配置温度监控软件-lm-sensors"><a href="#安装并配置温度监控软件-lm-sensors" class="headerlink" title="安装并配置温度监控软件 lm-sensors"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE%E6%B8%A9%E5%BA%A6%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6-lm-sensors"></a>安装并配置温度监控软件 lm-sensors</h2><p>1<br>2<br>3<br>4<br>5</p>
<p>apt-get install lm-sensors<br># 验证lm-sensors的版本<br>sensors -v<br>sensors-detect #获取可显示的温度,全部填YES<br>sensors #读取传感器</p>
<p>显示如下</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</p>
<p>root@wishzone:~# sensors<br>iwlwifi_1-virtual-0<br>Adapter: Virtual device<br>temp1: +53.0°C  </p>
<p>nvme-pci-0300<br>Adapter: PCI adapter<br>Composite: +60.9°C  </p>
<p>coretemp-isa-0000<br>Adapter: ISA adapter<br>Package id 0: +54.0°C (high = +105.0°C, crit = +105.0°C)<br>Core 0: +54.0°C (high = +105.0°C, crit = +105.0°C)<br>Core 1: +54.0°C (high = +105.0°C, crit = +105.0°C)<br>Core 2: +54.0°C (high = +105.0°C, crit = +105.0°C)<br>Core 3: +54.0°C (high = +105.0°C, crit = +105.0°C)</p>
<p>我们可以看出</p>
<p>iwlwifi_1-virtual-0是无线网卡温度<br>coretemp-isa-0000是 CPU 温度<br>使用命令lspci查询编号可知：<br>nvme-pci-0300是主硬盘温度</p>
<h2 id="定制显示温度内容"><a href="#定制显示温度内容" class="headerlink" title="定制显示温度内容"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%AE%9A%E5%88%B6%E6%98%BE%E7%A4%BA%E6%B8%A9%E5%BA%A6%E5%86%85%E5%AE%B9"></a>定制显示温度内容</h2><p>PVE 的 WebUI 控制台是使用Node.js实现的，所以要修改对应的文件，使得其可以定期执行sensors命令，并将结果输出 Web 页面上。</p>
<h3 id="修改Nodes-pm，获取温度"><a href="#修改Nodes-pm，获取温度" class="headerlink" title="修改Nodes.pm，获取温度"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E4%BF%AE%E6%94%B9Nodes-pm%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%B8%A9%E5%BA%A6"></a>修改Nodes.pm，获取温度</h3><p>1</p>
<p>nano /usr/share/perl5/PVE/API2/Nodes.pm</p>
<p>增加的内容</p>
<p>1</p>
<p>$res-&gt;{temperature} = `sensors`; # 获取 CPU 和 主板 的温度</p>
<p>增加的位置<br>ctrl+w搜索my $dinfo = df(‘/‘, 1)</p>
<p>在搜索内容的上面添加，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line"></span><br><span class="line">$res-&gt;&#123;ksm&#125; = &#123;</span><br><span class="line">shared =&gt; $meminfo-&gt;&#123;memshared&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$res-&gt;&#123;swap&#125; = &#123;</span><br><span class="line">free =&gt; $meminfo-&gt;&#123;swapfree&#125;,</span><br><span class="line">total =&gt; $meminfo-&gt;&#123;swaptotal&#125;,</span><br><span class="line">used =&gt; $meminfo-&gt;&#123;swapused&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$res-&gt;&#123;pveversion&#125; = PVE::pvecfg::package() . &quot;/&quot; .</span><br><span class="line">PVE::pvecfg::version_text();</span><br><span class="line"></span><br><span class="line">$res-&gt;&#123;temperature&#125; = `sensors`; # 获取 CPU 和 主板 的温度</span><br><span class="line"></span><br><span class="line">my $dinfo = df(&#x27;/&#x27;, 1); # output is bytes</span><br><span class="line"></span><br><span class="line">$res-&gt;&#123;rootfs&#125; = &#123;</span><br><span class="line">total =&gt; $dinfo-&gt;&#123;blocks&#125;,</span><br><span class="line">avail =&gt; $dinfo-&gt;&#123;bavail&#125;,</span><br><span class="line">used =&gt; $dinfo-&gt;&#123;used&#125;,</span><br><span class="line">free =&gt; $dinfo-&gt;&#123;blocks&#125; - $dinfo-&gt;&#123;used&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">return $res;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="修改pvemanagerlib-js，显示温度"><a href="#修改pvemanagerlib-js，显示温度" class="headerlink" title="修改pvemanagerlib.js，显示温度"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E4%BF%AE%E6%94%B9pvemanagerlib-js%EF%BC%8C%E6%98%BE%E7%A4%BA%E6%B8%A9%E5%BA%A6"></a>修改pvemanagerlib.js，显示温度</h3><p>1</p>
<p>vi /usr/share/pve-manager/js/pvemanagerlib.js</p>
<p>添加内容要根据自己的实际情况修改，注意逗号和括号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line">&#123;</span><br><span class="line">itemId: &#x27;temperature&#x27;,</span><br><span class="line">colspan: 2,</span><br><span class="line">printBar: false,</span><br><span class="line">title: gettext(&#x27;温度&#x27;),</span><br><span class="line">textField: &#x27;temperature&#x27;,</span><br><span class="line">renderer: function(value)&#123;</span><br><span class="line">const p0 = value.match(/Package id 0.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const b0 = value.match(/temp1.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const b1 = value.match(/Composite.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c0 = value.match(/Core 0.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c1 = value.match(/Core 1.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c2 = value.match(/Core 2.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c3 = value.match(/Core 3.*?\+([\d\.]+)?/)[1];</span><br><span class="line"></span><br><span class="line">return `CPU: $&#123;p0&#125;℃  Core0: $&#123;c0&#125;℃  Core1: $&#123;c1&#125;℃  Core2: $&#123;c2&#125;℃  Core3: $&#123;c3&#125;℃  无线网卡: $&#123;b0&#125;℃  系统盘: $&#123;b1&#125;℃ `</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自己照猫画虎改就行了，不难<br>增加的位置<br>ctrl+w搜索itemId: ‘version’,<br>在内容的下面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">itemId: &#x27;version&#x27;,</span><br><span class="line">colspan: 2,</span><br><span class="line">printBar: false,</span><br><span class="line">title: gettext(&#x27;PVE Manager Version&#x27;),</span><br><span class="line">textField: &#x27;pveversion&#x27;,</span><br><span class="line">value: &#x27;&#x27;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">itemId: &#x27;temperature&#x27;,</span><br><span class="line">colspan: 2,</span><br><span class="line">printBar: false,</span><br><span class="line">title: gettext(&#x27;温度&#x27;),</span><br><span class="line">textField: &#x27;temperature&#x27;,</span><br><span class="line">renderer: function(value)&#123;</span><br><span class="line">const p0 = value.match(/Package id 0.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const b0 = value.match(/temp1.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const b1 = value.match(/Composite.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c0 = value.match(/Core 0.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c1 = value.match(/Core 1.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c2 = value.match(/Core 2.*?\+([\d\.]+)?/)[1];</span><br><span class="line">const c3 = value.match(/Core 3.*?\+([\d\.]+)?/)[1];</span><br><span class="line"></span><br><span class="line">return `CPU: $&#123;p0&#125;℃  Core0: $&#123;c0&#125;℃  Core1: $&#123;c1&#125;℃  Core2: $&#123;c2&#125;℃  Core3: $&#123;c3&#125;℃  无线网卡: $&#123;b0&#125;℃  系统盘: $&#123;b1&#125;℃ `</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">updateTitle: function() &#123;</span><br><span class="line">var me = this;</span><br><span class="line">var uptime = Proxmox.Utils.render_uptime(me.getRecordValue(&#x27;uptime&#x27;));</span><br><span class="line">me.setTitle(me.pveSelNode.data.node + &#x27; (&#x27; + gettext(&#x27;Uptime&#x27;) + &#x27;: &#x27; + uptime + &#x27;)&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="修改完成，重启Web控制台"><a href="#修改完成，重启Web控制台" class="headerlink" title="修改完成，重启Web控制台"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E4%BF%AE%E6%94%B9%E5%AE%8C%E6%88%90%EF%BC%8C%E9%87%8D%E5%90%AFWeb%E6%8E%A7%E5%88%B6%E5%8F%B0"></a>修改完成，重启Web控制台</h3><p>systemctl restart pveproxy</p>
<p>注意：若温度的显示值为null，请打开开发者工具，在Console中进行查看</p>
<h2 id="懒人修改法"><a href="#懒人修改法" class="headerlink" title="懒人修改法"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E6%87%92%E4%BA%BA%E4%BF%AE%E6%94%B9%E6%B3%95"></a>懒人修改法</h2><p><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-6754687-1-1.html">点击这里，支持各种版本</a></p>
<h1 id="IMG文件创建虚拟机"><a href="#IMG文件创建虚拟机" class="headerlink" title="IMG文件创建虚拟机"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#IMG%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"></a>IMG文件创建虚拟机</h1><h2 id="创建虚拟机时选择无镜像"><a href="#创建虚拟机时选择无镜像" class="headerlink" title="创建虚拟机时选择无镜像"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%97%B6%E9%80%89%E6%8B%A9%E6%97%A0%E9%95%9C%E5%83%8F"></a>创建虚拟机时选择无镜像</h2><h2 id="创建完成后分离并删除磁盘"><a href="#创建完成后分离并删除磁盘" class="headerlink" title="创建完成后分离并删除磁盘"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90%E5%90%8E%E5%88%86%E7%A6%BB%E5%B9%B6%E5%88%A0%E9%99%A4%E7%A3%81%E7%9B%98"></a>创建完成后分离并删除磁盘</h2><h2 id="进入宿主机输入指令"><a href="#进入宿主机输入指令" class="headerlink" title="进入宿主机输入指令"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%BF%9B%E5%85%A5%E5%AE%BF%E4%B8%BB%E6%9C%BA%E8%BE%93%E5%85%A5%E6%8C%87%E4%BB%A4"></a>进入宿主机输入指令</h2><p>1<br>2<br>3<br>4<br>5<br>6</p>
<p>qm importdisk 103 /var/lib/vz/template/iso/DS3615xs.img local-lvm  </p>
<p>//103为虚拟机代号<br>///var/lib/vz/为存储镜像的磁盘的位置<br>//DS3615xs.img 为需要创建虚拟机的镜像<br>//local-lvm为所创建虚拟机的镜像的存储磁盘的名称</p>
<h2 id="进入虚拟机磁盘管理双击磁盘选择添加"><a href="#进入虚拟机磁盘管理双击磁盘选择添加" class="headerlink" title="进入虚拟机磁盘管理双击磁盘选择添加"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%BF%9B%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%E5%8F%8C%E5%87%BB%E7%A3%81%E7%9B%98%E9%80%89%E6%8B%A9%E6%B7%BB%E5%8A%A0"></a>进入虚拟机磁盘管理双击磁盘选择添加</h2><h2 id="进入虚拟机选项调整启动顺序"><a href="#进入虚拟机选项调整启动顺序" class="headerlink" title="进入虚拟机选项调整启动顺序"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E8%BF%9B%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%80%89%E9%A1%B9%E8%B0%83%E6%95%B4%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F"></a>进入虚拟机选项调整启动顺序</h2><h2 id="开机即可"><a href="#开机即可" class="headerlink" title="开机即可"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/PVE/#%E5%BC%80%E6%9C%BA%E5%8D%B3%E5%8F%AF"></a>开机即可</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/docker/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 21:59:45" itemprop="dateCreated datePublished" datetime="2023-09-12T21:59:45+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>docker的基本用法</p>
<h2 id="配置非root用户使用docker"><a href="#配置非root用户使用docker" class="headerlink" title="配置非root用户使用docker"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E9%85%8D%E7%BD%AE%E9%9D%9Eroot%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8docker"></a>配置非root用户使用docker</h2><h3 id="一、为用户添加root权限"><a href="#一、为用户添加root权限" class="headerlink" title="一、为用户添加root权限"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E4%B8%80%E3%80%81%E4%B8%BA%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0root%E6%9D%83%E9%99%90"></a>一、为用户添加root权限</h3><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A"></a>方法一：</h4><p>修改 /etc/sudoers 文件，找到下面一行，把前面的注释（#）去掉<br>Allows people in group wheel to run all commands<br>%wheel ALL=(ALL) ALL<br>然后修改用户，使其属于root组（wheel），命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -g root ithing</span><br></pre></td></tr></table></figure>
<p>修改完毕，现在可以用tommy帐号登录，然后用命令 su - ，即可获得root权限进行操作。</p>
<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A"></a>方法二：</h4><p>修改 /etc/sudoers 文件，找到下面一行，在root下面添加一行，如下所示：<br>Allow root to run any commands anywhere<br>root ALL=(ALL) ALL<br>ithing ALL=(ALL) ALL</p>
<p>如果，在修改/etc/sudoers 文件，你该错误了，会导致使用不了sudo命令，使用vim也打不开该文件了；</p>
<p><strong>解决方式</strong>：执行下面的命令</p>
<p>1</p>
<p>pkexec visudo</p>
<h3 id="二、为非root用户添加docker执行权限"><a href="#二、为非root用户添加docker执行权限" class="headerlink" title="二、为非root用户添加docker执行权限"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E4%BA%8C%E3%80%81%E4%B8%BA%E9%9D%9Eroot%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0docker%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90"></a>二、为非root用户添加docker执行权限</h3><h4 id="方式1：创建docker组"><a href="#方式1：创建docker组" class="headerlink" title="方式1：创建docker组"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E6%96%B9%E5%BC%8F1%EF%BC%9A%E5%88%9B%E5%BB%BAdocker%E7%BB%84"></a>方式1：创建docker组</h4><p>1<br>2<br>3<br>4</p>
<p>sudo groupadd docker #添加docker用户组<br>sudo gpasswd -a $USER docker #将登陆用户加入到docker用户组中<br>newgrp docker #更新用户组<br>docker ps #测试docker命令是否可以使用sudo正常使用</p>
<h4 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A"></a>方式二：</h4><p>直接修改 /var/run/docker.sock文件（这样是所有的用户都可操作docker,这样不安全，但是如果安全性要求不高，就可这样做）</p>
<p>先查看一下默认这个文件/var/run/docker.sock的权限是啥 ？</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<p>$ sudo ls -al /var/run/docker.sock<br>srw-rw—— 1 root root 0 Feb 15 03:13 /var/run/docker.sock  </p>
<h1 id="修改文件权限"><a href="#修改文件权限" class="headerlink" title="修改文件权限"></a>修改文件权限</h1><p>sudo chmod 666 /var/run/docker.sock  </p>
<h1 id="修改后，再查看一下这个文件的权限"><a href="#修改后，再查看一下这个文件的权限" class="headerlink" title="修改后，再查看一下这个文件的权限"></a>修改后，再查看一下这个文件的权限</h1><p>$ sudo ls -al /var/run/docker.sock<br>srw-rw-rw- 1 root root 0 Feb 15 03:14 /var/run/docker.sock</p>
<h2 id="镜像操作"><a href="#镜像操作" class="headerlink" title="镜像操作"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"></a>镜像操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull xxx //拉取镜像</span><br><span class="line">docker image list //查看镜像</span><br><span class="line">docker image rm [ID] //删除镜像</span><br><span class="line">cat docker/xxx.tar  docker import - xxx:v1 //导入本地包到镜像</span><br></pre></td></tr></table></figure>
<h2 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"></a>容器操作</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run —name=xyz -it xxx /bin/bash //前台运行docker run —name=xyz -itd xxx /bin/bash //后台运行docker exec -it [ID] /bin/bash //进入运行中的容器docker stop [ID] //停止容器docker restart [ID] //重启容器docker rm -f [ID] //删除容器docker export [ID] &gt; xxx.tar //导出容器到本地包docker container prune //清除所有停止的容器docker commit -m=”has update” -a=”runoob” [ID] name:v2 //提交容器为镜像</span><br></pre></td></tr></table></figure>
<h2 id="修改映射地址和端口（wordpress为例）"><a href="#修改映射地址和端口（wordpress为例）" class="headerlink" title="修改映射地址和端口（wordpress为例）"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E4%BF%AE%E6%94%B9%E6%98%A0%E5%B0%84%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%EF%BC%88wordpress%E4%B8%BA%E4%BE%8B%EF%BC%89"></a>修改映射地址和端口（wordpress为例）</h2><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</p>
<p># 1. 进入到容器中<br>docker exec -it wordpress bash<br>ls  </p>
<p># 2. 官方的 wordpress 镜像中并没有预装vim编辑器，所以要先装一下编辑器<br>apt-get update<br>apt-get install vim  </p>
<p># 3. 编辑 wp-config.php 文件<br>vi wp-config.php  </p>
<p># 找到 define ‘DB_HOST’ 那一行修改<br># 按【i】进入输入模式，移动光标去修改<br># 按键盘左上角【退出Esc】切换到命令模式，输入【:wq 】保存后离开</p>
<h2 id="推送操作"><a href="#推送操作" class="headerlink" title="推送操作"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Docker/#%E6%8E%A8%E9%80%81%E6%93%8D%E4%BD%9C"></a>推送操作</h2><p>docker push xxx //推送xxx到仓库</p>
<p>注意docker镜像需要提前改名才能推送（name/xxx:v1.0）</p>
<h2 id="COMMAND查询命令"><a href="#COMMAND查询命令" class="headerlink" title="COMMAND查询命令"></a>COMMAND查询命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a --no-trunc</span><br></pre></td></tr></table></figure>
<h2 id="Docker的三种网络代理配置"><a href="#Docker的三种网络代理配置" class="headerlink" title="Docker的三种网络代理配置"></a>Docker的三种网络代理配置</h2><h3 id="dockerd代理-¶"><a href="#dockerd代理-¶" class="headerlink" title="dockerd代理 ¶"></a>dockerd代理 <a target="_blank" rel="noopener" href="https://note.qidong.name/2020/05/docker-proxy/#dockerd%e4%bb%a3%e7%90%86">¶</a></h3><p>在执行<code>docker pull</code>时，是由守护进程<code>dockerd</code>来执行。 因此，代理需要配在<code>dockerd</code>的环境中。 而这个环境，则是受<code>systemd</code>所管控，因此实际是<code>systemd</code>的配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">sudo touch /etc/systemd/system/docker.service.d/proxy.conf</span><br></pre></td></tr></table></figure>
<p>在这个<code>proxy.conf</code>文件（可以是任意<code>*.conf</code>的形式）中，添加以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Environment=&quot;HTTP_PROXY=http://proxy.example.com:8080/&quot;</span><br><span class="line">Environment=&quot;HTTPS_PROXY=http://proxy.example.com:8080/&quot;</span><br><span class="line">Environment=&quot;NO_PROXY=localhost,127.0.0.1,.example.com&quot;</span><br></pre></td></tr></table></figure>
<p>其中，<code>proxy.example.com:8080</code>要换成可用的免密代理。 通常使用<code>cntlm</code>在本机自建免密代理，去对接公司的代理。 可参考《<a target="_blank" rel="noopener" href="https://note.qidong.name/2018/11/cntlm-proxy/">Linux下安装配置Cntlm代理</a>》。</p>
<h3 id="Container代理-¶"><a href="#Container代理-¶" class="headerlink" title="Container代理 ¶"></a>Container代理 <a target="_blank" rel="noopener" href="https://note.qidong.name/2020/05/docker-proxy/#container%e4%bb%a3%e7%90%86">¶</a></h3><p>在容器运行阶段，如果需要代理上网，则需要配置<code>~/.docker/config.json</code>。 以下配置，只在Docker 17.07及以上版本生效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;proxies&quot;:</span><br><span class="line"> &#123;</span><br><span class="line">   &quot;default&quot;:</span><br><span class="line">   &#123;</span><br><span class="line">     &quot;httpProxy&quot;: &quot;http://proxy.example.com:8080&quot;,</span><br><span class="line">     &quot;httpsProxy&quot;: &quot;http://proxy.example.com:8080&quot;,</span><br><span class="line">     &quot;noProxy&quot;: &quot;localhost,127.0.0.1,.example.com&quot;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是用户级的配置，除了<code>proxies</code>，<code>docker login</code>等相关信息也会在其中。 而且还可以配置信息展示的格式、插件参数等。</p>
<p>此外，容器的网络代理，也可以直接在其运行时通过<code>-e</code>注入<code>http_proxy</code>等环境变量。 这两种方法分别适合不同场景。 <code>config.json</code>非常方便，默认在所有配置修改后启动的容器生效，适合个人开发环境。 在CI/CD的自动构建环境、或者实际上线运行的环境中，这种方法就不太合适，用<code>-e</code>注入这种显式配置会更好，减轻对构建、部署环境的依赖。 当然，在这些环境中，最好用良好的设计避免配置代理上网。</p>
<h3 id="docker-build代理-¶"><a href="#docker-build代理-¶" class="headerlink" title="docker build代理 ¶"></a><code>docker build</code>代理 <a target="_blank" rel="noopener" href="https://note.qidong.name/2020/05/docker-proxy/#docker-build%e4%bb%a3%e7%90%86">¶</a></h3><p>虽然<code>docker build</code>的本质，也是启动一个容器，但是环境会略有不同，用户级配置无效。 在构建时，需要注入<code>http_proxy</code>等参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build . \</span><br><span class="line">    --build-arg &quot;HTTP_PROXY=http://proxy.example.com:8080/&quot; \</span><br><span class="line">    --build-arg &quot;HTTPS_PROXY=http://proxy.example.com:8080/&quot; \</span><br><span class="line">    --build-arg &quot;NO_PROXY=localhost,127.0.0.1,.example.com&quot; \</span><br><span class="line">    -t your/image:tag</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：无论是<code>docker run</code>还是<code>docker build</code>，默认是网络隔绝的。 如果代理使用的是<code>localhost:3128</code>这类，则会无效。 这类仅限本地的代理，必须加上<code>--network host</code>才能正常使用。 而一般则需要配置代理的外部IP，而且代理本身要开启gateway模式。</p>
<h3 id="重启生效-¶"><a href="#重启生效-¶" class="headerlink" title="重启生效 ¶"></a>重启生效 <a target="_blank" rel="noopener" href="https://note.qidong.name/2020/05/docker-proxy/#%e9%87%8d%e5%90%af%e7%94%9f%e6%95%88">¶</a></h3><p>代理配置完成后，<code>reboot</code>重启当然可以生效，但不重启也行。</p>
<p><code>docker build</code>代理是在执行前设置的，所以修改后，下次执行立即生效。 Container代理的修改也是立即生效的，但是只针对以后启动的Container，对已经启动的Container无效。</p>
<p><code>dockerd</code>代理的修改比较特殊，它实际上是改<code>systemd</code>的配置，因此需要重载<code>systemd</code>并重启<code>dockerd</code>才能生效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h3 id="参考-¶"><a href="#参考-¶" class="headerlink" title="参考 ¶"></a>参考 <a target="_blank" rel="noopener" href="https://note.qidong.name/2020/05/docker-proxy/#%e5%8f%82%e8%80%83">¶</a></h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/config/daemon/systemd/">Control Docker with systemd Docker Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/network/proxy/">Configure Docker to use a proxy server Docker Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cli/">Use the Docker command line Docker Documentation</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/openwrt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/openwrt/" class="post-title-link" itemprop="url">Openwrt</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 21:59:10" itemprop="dateCreated datePublished" datetime="2023-09-12T21:59:10+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Openwrt的配置问题及解决方法</p>
<h2 id="开启80端口和22端口"><a href="#开启80端口和22端口" class="headerlink" title="开启80端口和22端口"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E5%BC%80%E5%90%AF80%E7%AB%AF%E5%8F%A3%E5%92%8C22%E7%AB%AF%E5%8F%A3"></a>开启80端口和22端口</h2><p>由于小米路由为了安全考虑，对WEB与防火墙规则进行限制，WEB管理、SSH只能通过内网登 陆，外网无法访问，在路由器的WEB管理页面新建端口转发中不能添加路由本机内网IP。<br>开启小米路由的SSH后，我们可以通过登陆SSH在命令行中手动添加防火墙中端口转发规则</p>
<h3 id="一、解除WEB管理页面访问限制"><a href="#一、解除WEB管理页面访问限制" class="headerlink" title="一、解除WEB管理页面访问限制"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E4%B8%80%E3%80%81%E8%A7%A3%E9%99%A4WEB%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6"></a>一、解除WEB管理页面访问限制</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/sysapihttpd/ //切换目录</span><br><span class="line">cp miwifi-webinitrd.conf miwifi-webinitrd.conf.bak //备份</span><br><span class="line">vi miwifi-webinitrd.conf //编辑miwifi-webinitrd.conf</span><br><span class="line"></span><br><span class="line">在如下位置插入代码set $finalvar &quot;$canproxy $isluci&quot;;：</span><br><span class="line"></span><br><span class="line">set $isluci &quot;1&quot;;</span><br><span class="line"></span><br><span class="line">set $finalvar &quot;$canproxy $isluci&quot;;</span><br><span class="line"></span><br><span class="line">/etc/init.d/sysapihttpd restart //重启httpd服务使配置生效</span><br></pre></td></tr></table></figure>
<p>二、手动添加防火墙端口转发规则，开启外网访问WEB管理和SSH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cd / //回到根目录</span><br><span class="line">vi /etc/config/firewall //编辑防火墙配置</span><br><span class="line">1.添加WEB管理外网端口转发规则代码段：</span><br><span class="line">config redirect &#x27;MIWEB&#x27;</span><br><span class="line">option src &#x27;wan&#x27;</span><br><span class="line">option src_dport &#x27;1314&#x27;</span><br><span class="line">option dest_ip &#x27;10.0.0.1&#x27;</span><br><span class="line">option name &#x27;WEB&#x27;</span><br><span class="line">option ftype &#x27;1&#x27;</span><br><span class="line">option dest_port &#x27;80&#x27;</span><br><span class="line">option proto &#x27;tcp&#x27;</span><br><span class="line"></span><br><span class="line">WEB管理界面外网端口为1314 可通过外网IP:1314访问 (例 http://61.181.133.5:1314),绑定DDNS的用户可通过域名:1314进行访问。</span><br><span class="line">2.添加SSH外网登陆端口转发规则代码段：</span><br><span class="line">config redirect &#x27;Myssh&#x27;</span><br><span class="line">option src &#x27;wan&#x27;</span><br><span class="line">option src_dport &#x27;2345&#x27;</span><br><span class="line">option dest &#x27;lan&#x27;</span><br><span class="line">option dest_port &#x27;22&#x27;</span><br><span class="line">option proto &#x27;tcp&#x27;</span><br><span class="line"></span><br><span class="line">SSH登陆外网端口为2345</span><br><span class="line">重启防火墙使规则生效</span><br><span class="line"></span><br><span class="line">/etc/init.d/firewall restart</span><br></pre></td></tr></table></figure>
<h3 id="查看端口状态："><a href="#查看端口状态：" class="headerlink" title="查看端口状态："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81%EF%BC%9A"></a>查看端口状态：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L -n</span><br></pre></td></tr></table></figure>
<h2 id="Openwrt编译指南"><a href="#Openwrt编译指南" class="headerlink" title="Openwrt编译指南"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#Openwrt%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97"></a>Openwrt编译指南</h2><h3 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"></a>安装编译环境</h3><h4 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA"></a>安装虚拟机</h4><h4 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83"></a>配置环境</h4><h4 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"></a><a target="_blank" rel="noopener" href="https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem#debianubuntu">安装软件</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">根据系统选择合适的代码复制粘贴即可</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install build-essential clang flex bison g++ gawk gcc-multilib g++-multilib gettext git libncurses-dev libssl-dev python3-distutils rsync unzip zlib1g-dev file wget</span><br></pre></td></tr></table></figure>
<h3 id="配置源码"><a href="#配置源码" class="headerlink" title="配置源码"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E9%85%8D%E7%BD%AE%E6%BA%90%E7%A0%81"></a><a target="_blank" rel="noopener" href="https://openwrt.org/docs/guide-developer/toolchain/use-buildsystem">配置源码</a></h3><h4 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81"></a>下载源码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://git.openwrt.org/openwrt/openwrt.git [&lt;buildroot&gt;]</span><br></pre></td></tr></table></figure>
<h4 id="切换版本"><a href="#切换版本" class="headerlink" title="切换版本"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E5%88%87%E6%8D%A2%E7%89%88%E6%9C%AC"></a>切换版本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag //查看版本</span><br><span class="line">git checkout v22.03.5 //切换到22.03.5</span><br></pre></td></tr></table></figure>
<h4 id="更新源码"><a href="#更新源码" class="headerlink" title="更新源码"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E6%9B%B4%E6%96%B0%E6%BA%90%E7%A0%81"></a>更新源码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure>
<h4 id="更新feeds"><a href="#更新feeds" class="headerlink" title="更新feeds"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E6%9B%B4%E6%96%B0feeds"></a>更新feeds</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Pull the latest updates for the feeds in case it became outdated.</span><br><span class="line"></span><br><span class="line">./scripts/feeds update -a</span><br><span class="line">Make the downloaded package/packages available in make menuconfig.</span><br><span class="line"></span><br><span class="line">./scripts/feeds install &lt;package_name&gt;</span><br><span class="line">./scripts/feeds install -a</span><br></pre></td></tr></table></figure>
<h4 id="配置软件"><a href="#配置软件" class="headerlink" title="配置软件"></a>配置软件<a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#make-menuconfig"></a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E7%BC%96%E8%AF%91"></a>编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make download V=s</span><br><span class="line">make V=s</span><br></pre></td></tr></table></figure>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Openwrt/#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"></a>获取镜像</h3><p>进入/bin/target<br>xxx.combined.img即为编译的镜像</p>
<h2 id="多线与多拨"><a href="#多线与多拨" class="headerlink" title="多线与多拨"></a>多线与多拨</h2><p>提高网络带宽的方法有很多，单线多拨，多线单拨，多线多拨。其本质上都是获取多个IP地址；</p>
<h3 id="多线"><a href="#多线" class="headerlink" title="多线"></a>多线</h3><p>即设置多个WAN口，并通过DHCP或PPPoE获取多个不同的IP；</p>
<h3 id="多拨"><a href="#多拨" class="headerlink" title="多拨"></a>多拨</h3><p>实现的原理通常是先通过macvlan生成多个虚拟网口，类似内部虚拟出交换机，然后在交换机上面进行拨号获取IP，可以使用同样的账号拨号获取IP，也可以使用不同的账号拨号或者DHCP获取IP，具体得看发送端的限制。多拨实现的方法很简单，只需要利用macvlan，因此手写脚本就可以。</p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>很多人将负载均衡和端口聚合混淆，简单来说端口聚合是需要有运营商控制的通过多通道提升网络带宽的方法，它需要发送端和接收端都是可控的，最终是只获得一个IP地址；而负载均衡仅仅是将多路的网络流量均匀的分发，最终获得的还是多个IP地址，它只需要接收端可控即可，因此对于一些高安全性的应用使用负载均衡可能会无法访问。</p>
<h3 id="安装软件-1"><a href="#安装软件-1" class="headerlink" title="安装软件"></a>安装软件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install mwan3 luci-app-mwan3</span><br></pre></td></tr></table></figure>
<h3 id="配置软件-1"><a href="#配置软件-1" class="headerlink" title="配置软件"></a>配置软件</h3><p>首先获取多IP，在网络-负载均衡-接口中依据网络-接口中的名称依次设置相同的名称，跟踪的主机填写www.baidu.com,8.8.8.8,刷新连接跟踪表选择总是；</p>
<p>在成员中设置相同数量的成员，名称自定义，跃点数和权众都设置为1；</p>
<p>进入策略，添加一个策略，名称自定义，将所有成员都添加进去；</p>
<p>进入规则，添加一个规则，将设置的策略添加进去即可；</p>
<h3 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h3><p>进入状态-负载均衡可以看到网口是否在线，详细信息可以看到权重；</p>
<h2 id="常见问题及解决方法"><a href="#常见问题及解决方法" class="headerlink" title="常见问题及解决方法"></a>常见问题及解决方法</h2><h3 id="无法安装软件"><a href="#无法安装软件" class="headerlink" title="无法安装软件"></a>无法安装软件</h3><p>1.根据提示安装依赖软件</p>
<p>2.冲突时根据提示删除文件</p>
<p>如：删除 /etc/init.d/frpc 后再安装。</p>
<p>提示如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg install luci-app-frpc_1.2.1-1_all.ipk</span><br><span class="line">Installing luci-app-frpc (1.2.1-1) to root...</span><br><span class="line">Collected errors:</span><br><span class="line">   check_data_file_clashes: Package luci-app-frpc wants to install file /etc/init.d/frpc</span><br><span class="line">   But that file is already provided by package * frpc</span><br><span class="line">   opkg_install_cmd: Cannot install package luci-app-frpc.</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/linux/" class="post-title-link" itemprop="url">Linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 21:58:29" itemprop="dateCreated datePublished" datetime="2023-09-12T21:58:29+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Linux一些问题和解决方法</p>
<h1 id="远程访问方式对比"><a href="#远程访问方式对比" class="headerlink" title="远程访问方式对比"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94"></a>远程访问方式对比</h1><h2 id="XRDP"><a href="#XRDP" class="headerlink" title="XRDP"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#XRDP"></a>XRDP</h2><h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E7%BC%BA%E7%82%B9%EF%BC%9A"></a>缺点：</h3><p>1.通常只支持X类的管理器<br>2.不能多用户同时登录<br>3.Linux下不支持UDP协议</p>
<h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E4%BC%98%E7%82%B9%EF%BC%9A"></a>优点：</h3><p>1.安装包小<br>2.安装简单<br>3.画质高，速度快</p>
<h2 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#VNC"></a>VNC</h2><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E7%BC%BA%E7%82%B9"></a>缺点</h3><p>1.显示效果相对较差<br>2.需要HDMI诱骗器</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E4%BC%98%E7%82%B9"></a>优点</h3><p>1.支持UDP，相应快</p>
<h1 id="Linux系统设置开机启动的三种方式："><a href="#Linux系统设置开机启动的三种方式：" class="headerlink" title="Linux系统设置开机启动的三种方式："></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#Linux%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%EF%BC%9A"></a>Linux系统设置开机启动的三种方式：</h1><h2 id="1-在-etc-rc-local添加需要启动的命令"><a href="#1-在-etc-rc-local添加需要启动的命令" class="headerlink" title="1.在/etc/rc.local添加需要启动的命令"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#1-%E5%9C%A8-etc-rc-local%E6%B7%BB%E5%8A%A0%E9%9C%80%E8%A6%81%E5%90%AF%E5%8A%A8%E7%9A%84%E5%91%BD%E4%BB%A4"></a>1.在/etc/rc.local添加需要启动的命令</h2><p>这样系统在启动的时候会自动执行这些命令。</p>
<h2 id="2-使用systemd服务管理器"><a href="#2-使用systemd服务管理器" class="headerlink" title="2.使用systemd服务管理器"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#2-%E4%BD%BF%E7%94%A8systemd%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%EF%BC%8C"></a>2.使用systemd服务管理器</h2><p>在/etc/systemd/system目录下创建一个service文件，指定需要启动的服务和相关参数。</p>
<p>1</p>
<p>sudo nano /lib/systemd/system/frpc.service</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</p>
<p>[Unit]  </p>
<h1 id="服务描述"><a href="#服务描述" class="headerlink" title="服务描述"></a>服务描述</h1><p>Description=frpc service<br>After=network.target syslog.target<br>Wants=network.target  </p>
<p>[Service]<br>Type=simple  </p>
<h1 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h1><p>ExecStart=/usr/local/frpc/frpc -c /usr/local/frpc/frpc.ini  </p>
<p>[Install]<br>WantedBy=multi-user.target</p>
<p>1<br>2</p>
<p>systemctl daemon-reload<br>sudo systemctl enable frpc</p>
<h2 id="3-将需要启动的命令添加到用户的bashrc文件中，这样每个用户登录时都会自动执行这些命令。"><a href="#3-将需要启动的命令添加到用户的bashrc文件中，这样每个用户登录时都会自动执行这些命令。" class="headerlink" title="3. 将需要启动的命令添加到用户的bashrc文件中，这样每个用户登录时都会自动执行这些命令。"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#3-%E5%B0%86%E9%9C%80%E8%A6%81%E5%90%AF%E5%8A%A8%E7%9A%84%E5%91%BD%E4%BB%A4%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84bashrc%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%AF%8F%E4%B8%AA%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%97%B6%E9%83%BD%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E8%BF%99%E4%BA%9B%E5%91%BD%E4%BB%A4%E3%80%82"></a>3. 将需要启动的命令添加到用户的bashrc文件中，这样每个用户登录时都会自动执行这些命令。</h2><h1 id="退出XRDP未注销的用户"><a href="#退出XRDP未注销的用户" class="headerlink" title="退出XRDP未注销的用户"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E9%80%80%E5%87%BAXRDP%E6%9C%AA%E6%B3%A8%E9%94%80%E7%9A%84%E7%94%A8%E6%88%B7"></a>退出XRDP未注销的用户</h1><p>1<br>2</p>
<p>who -a //查看登录的用户<br>pkill -kill -t pts/3 //注销用户</p>
<h1 id="创建新用户"><a href="#创建新用户" class="headerlink" title="创建新用户"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%94%A8%E6%88%B7"></a>创建新用户</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">apt install sudo</span><br><span class="line">sudo usermod -aG sudo username //username替换为所需的用户名</span><br><span class="line">nano /etc/default/useradd</span><br><span class="line">改/bin/sh为/bin/bash</span><br><span class="line">nano /etc/passwd</span><br><span class="line">改用户名后面的/bin/sh为/bin/bash</span><br><span class="line">设置免sudo</span><br><span class="line">sudo visudo</span><br><span class="line">在文件最后加上一句（改为自己的用户名）：</span><br><span class="line">wishzone ALL=(ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure>
<h1 id="Ubuntu优化"><a href="#Ubuntu优化" class="headerlink" title="Ubuntu优化"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#Ubuntu%E4%BC%98%E5%8C%96"></a>Ubuntu优化</h1><h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"></a>安装软件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gparted htop net-tools putty vim xrdp tofrodos iproute2 gawk gcc g++ git make libncurses5-dev tftpd zlib1g:i386 libssl-dev flex bison libselinux1 gnupg wget diffstat chrpath socat xterm autoconf libtool tar unzip texinfo zlib1g-dev gcc-multilib build-essential libsdl1.2-dev libglib2.0-dev screen pax gzip automake tftpd-hpa ubuntu-restricted-extras gnome-tweaks gnome-shell-extension-manager indicator-multiload libncurses5 libtinfo5 libncurses5-dev libncursesw5-dev samba ssh</span><br><span class="line">sudo apt install tftpd-hpa ncurses-compat-libs</span><br><span class="line">service tftpd-hpa restart</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure dash (选NO）</span><br><span class="line">添加xrdp组：</span><br><span class="line">sudo adduser xrdp ssl-cert  </span><br></pre></td></tr></table></figure>
<h2 id="解决“色彩管理设备”"><a href="#解决“色彩管理设备”" class="headerlink" title="解决“色彩管理设备”"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E8%A7%A3%E5%86%B3%E2%80%9C%E8%89%B2%E5%BD%A9%E7%AE%A1%E7%90%86%E8%AE%BE%E5%A4%87%E2%80%9D"></a>解决“色彩管理设备”</h2><p>sudo nano /etc/polkit-1/localauthority/50-local.d/45-allow-colord.pkla</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<p>[Allow Colord all Users]<br>Identity=unix-user:*<br>Action=org.freedesktop.color-manager.create-device;org.freedesktop.color-manager.create-profile;org.freedesktop.color-manager.delete-device;org.freedesktop.color-manager.delete-profile;org.freedesktop.color-manager.modify-device;org.freedesktop.color-manager.modify-profile<br>ResultAny=no<br>ResultInactive=no<br>ResultActive=yes</p>
<h2 id="解决“刷新系统软件源需要认证”"><a href="#解决“刷新系统软件源需要认证”" class="headerlink" title="解决“刷新系统软件源需要认证”"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E8%A7%A3%E5%86%B3%E2%80%9C%E5%88%B7%E6%96%B0%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6%E6%BA%90%E9%9C%80%E8%A6%81%E8%AE%A4%E8%AF%81%E2%80%9D"></a>解决“刷新系统软件源需要认证”</h2><p>nano /etc/polkit-1/localauthority/50-local.d/46-allow-packagekit.pkla</p>
<p>1<br>2<br>3<br>4<br>5<br>6</p>
<p>[Allow Refresh Repository all Users]<br>Identity=unix-user:*<br>Action=org.freedesktop.packagekit.system-sources-refresh<br>ResultAny=no<br>ResultInactive=no<br>ResultActive=yes</p>
<h2 id="解决“扫描WIFI需要认证”"><a href="#解决“扫描WIFI需要认证”" class="headerlink" title="解决“扫描WIFI需要认证”"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E8%A7%A3%E5%86%B3%E2%80%9C%E6%89%AB%E6%8F%8FWIFI%E9%9C%80%E8%A6%81%E8%AE%A4%E8%AF%81%E2%80%9D"></a>解决“扫描WIFI需要认证”</h2><p>sudo nano /etc/polkit-1/localauthority/50-local-d/allow-wifiscan</p>
<p>1<br>2<br>3<br>4<br>5<br>6</p>
<p>[Allow Wifi Scan]<br>Identity=unix-user:*<br>Action=org.freedesktop.NetworkManager.wifi.scan;org.freedesktop.NetworkManager.enable-disable-wifi;org.freedesktop.NetworkManager.settings.modify.own;org.freedesktop.NetworkManager.settings.modify.system;org.freedesktop.NetworkManager.network-control<br>ResultAny=yes<br>ResultInactive=yes<br>ResultActive=yes</p>
<h1 id="自定义二级域名"><a href="#自定义二级域名" class="headerlink" title="自定义二级域名"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D"></a>自定义二级域名</h1><p>在多人同时使用一个 frps 时，通过自定义二级域名的方式来使用会更加方便。</p>
<p>通过在 frps 的配置文件中配置 subdomain_host，就可以启用该特性。之后在 frpc 的 http、https 类型的代理中可以不配置 custom_domains，而是配置一个 subdomain 参数。</p>
<p>只需要将 *.{subdomain_host} 解析到 frps 所在服务器。之后用户可以通过 subdomain 自行指定自己的 web 服务所需要使用的二级域名，通过 {subdomain}.{subdomain_host} 来访问自己的 web 服务。</p>
<h2 id="frps-ini"><a href="#frps-ini" class="headerlink" title="frps.ini"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#frps-ini"></a>frps.ini</h2><p>[common]<br>subdomain_host = frps.com<br>将泛域名 *.frps.com 解析到 frps 所在服务器的 IP 地址。</p>
<h2 id="frpc-ini"><a href="#frpc-ini" class="headerlink" title="frpc.ini"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#frpc-ini"></a>frpc.ini</h2><p>[web]<br>type = http<br>local_port = 80<br>subdomain = test<br>frps 和 frpc 都启动成功后，通过 test.frps.com 就可以访问到内网的 web 服务。</p>
<p>注：如果 frps 配置了 subdomain_host，则 custom_domains 中不能是属于 subdomain_host 的子域名或者泛域名。</p>
<p>同一个 http 或 https 类型的代理中 custom_domains 和 subdomain 可以同时配置。</p>
<h1 id="改Python源"><a href="#改Python源" class="headerlink" title="改Python源"></a>改Python源</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~mkdir .pipsudo nano ~/.pip/pip.conf[global]index-url = https://pypi.tuna.tsinghua.edu.cn/simple/[install]trusted-host = pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure>
<h1 id="Ubuntu常见问题及解决办法"><a href="#Ubuntu常见问题及解决办法" class="headerlink" title="Ubuntu常见问题及解决办法"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#Ubuntu%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"></a>Ubuntu常见问题及解决办法</h1><h2 id="由于没有公钥，无法验证下列签名：-NO-PUBKEY-76F1A20FF987672F"><a href="#由于没有公钥，无法验证下列签名：-NO-PUBKEY-76F1A20FF987672F" class="headerlink" title="由于没有公钥，无法验证下列签名： NO_PUBKEY 76F1A20FF987672F"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/24/Linux/#%E7%94%B1%E4%BA%8E%E6%B2%A1%E6%9C%89%E5%85%AC%E9%92%A5%EF%BC%8C%E6%97%A0%E6%B3%95%E9%AA%8C%E8%AF%81%E4%B8%8B%E5%88%97%E7%AD%BE%E5%90%8D%EF%BC%9A-NO-PUBKEY-76F1A20FF987672F"></a>由于没有公钥，无法验证下列签名： NO_PUBKEY 76F1A20FF987672F</h2><p>1</p>
<p>apt-key adv —keyserver keyserver.ubuntu.com —recv-keys ${PUBLIC_KEY_SIGN}</p>
<h2 id="Linux迁移硬盘导致启动进入紧急模式"><a href="#Linux迁移硬盘导致启动进入紧急模式" class="headerlink" title="Linux迁移硬盘导致启动进入紧急模式"></a>Linux迁移硬盘导致启动进入紧急模式</h2><p>参考</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/ecs/use-cases/configure-uuids-in-the-fstab-file-to-automatically-attach-data-disks">https://help.aliyun.com/zh/ecs/use-cases/configure-uuids-in-the-fstab-file-to-automatically-attach-data-disks</a></p>
<p><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/trouble-ecs/ecs_trouble_0310.html">https://support.huaweicloud.com/trouble-ecs/ecs_trouble_0310.html</a></p>
<p>原因：通常是由于目的硬盘和源硬盘的某些分区的uuid不对映导致的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#输入密码进入系统</span><br><span class="line">#挂载所有分区并查看不能挂载的分区的名字</span><br><span class="line">mount -a</span><br><span class="line">#查询数据盘的UUID信息</span><br><span class="line">fdisk -lu#编辑挂载文件修改相应uuid即可</span><br><span class="line">vi /etc/fstab</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-320x320.png">
      <meta itemprop="name" content="Wishzone">
      <meta itemprop="description" content="该网站仅为机械移植">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="请移步以下网址">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/12/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">数据管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-12 21:57:04" itemprop="dateCreated datePublished" datetime="2023-09-12T21:57:04+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-25 23:04:34" itemprop="dateModified" datetime="2023-10-25T23:04:34+08:00">2023-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> 发表于 2023-08-27   更新于 2023-08-28</p>
<p>mysql数据管理</p>
<h1 id="Docker-WordPress搭建网站"><a href="#Docker-WordPress搭建网站" class="headerlink" title="Docker+WordPress搭建网站"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/27/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/#Docker-WordPress%E6%90%AD%E5%BB%BA%E7%BD%91%E7%AB%99"></a>Docker+WordPress搭建网站</h1><p>1.本地安装好 Docker 软件<br>2.拉取 WordPress 镜像</p>
<p>1</p>
<p>docker pull wordpress</p>
<p>3.启动 MySQL 容器</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<p>docker run -d -p 3123:3306 —name wpmysql -e MYSQL_ROOT_PASSWORD=123456 mysql  </p>
<p># run: 启动一个容器<br># -d: 启动的容器在后台运行<br># —name: 容器名 wpmysql<br># -e MYSQL_ROOT_PASSWORD: 设置 MySQL 的 root 密码<br># -p：映射端口，将容器的3306端口映射到主机的3123端口<br># mysql：启动的镜像，如果具体版本，这里也要加上具体版本号 mysql:5.2</p>
<p>4.启动 WordPress 容器，并连接到 MySQL 容器上</p>
<p>1<br>2<br>3<br>4</p>
<p>docker run -d -p 8088:80 —name wordpress —link wpmysql:mysql wordpress<br># -p：映射端口，本地访问路径：<a target="_blank" rel="noopener" href="http://localhost:8088">http://localhost:8088</a><br># —link：将 wpmysql 容器挂载到 mysql 上，这样 WordPress 才能访问<br>不出意外的话，在浏览器打开后设置好数据库信息看到的是这样的：</p>
<p>5.配置Mysql</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<p># 1.进入mysql容器<br>docker exec -it wpmysql bash<br># 2.登录mysql<br>mysql -uroot -p<br># 3.授权root用户在其他机器上运行：host为 % 表示不限制ip，默认的localhost表示本机使用<br>grant all on *.* to ‘root’@’%’;<br># 4.如果是 mysql8 版本，由于不支持动态修改密码验证，还需要更新root用户密码<br>alter user ‘root’@’%’ identified with mysql_native_password by ‘123456’;<br># 5.自己创建一个名字为 wordpress 的数据库(要跟wordpress安装是让配置的名字一致)<br>create database wordpress;<br># 6.刷新权限<br>flush privileges;</p>
<h1 id="Docker-Phpmyadmin"><a href="#Docker-Phpmyadmin" class="headerlink" title="Docker+Phpmyadmin"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/27/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/#Docker-Phpmyadmin"></a>Docker+Phpmyadmin</h1><p>1.本地安装好 Docker 软件<br>2.拉取 Phpmyadmin 镜像</p>
<p>1</p>
<p>docker pull phpmyadmin</p>
<p>3.启动 Phpmyadmin 容器</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<p>docker run —restart always —name myadmin -d -e PMA_ARBITRARY=1 -p 8080:80 phpmyadmin  </p>
<p>参数介绍：<br>PMA_ARBITRARY -设置为1时，将允许连接到任意服务器<br>PMA_HOST -定义MySQL服务器的地址/主机名<br>PMA_VERBOSE -定义MySQL服务器的详细名称<br>PMA_PORT -定义MySQL服务器的端口<br>PMA_HOSTS -定义逗号分隔的MySQL服务器的地址/主机名列表<br>PMA_VERBOSES -定义以逗号分隔的MySQL服务器详细名称列表<br>PMA_PORTS -定义以逗号分隔的MySQL服务器端口列表<br>PMA_USER和PMA_PASSWORD-定义用于配置身份验证方法的用户名<br>PMA_ABSOLUTE_URI -定义面向用户的URI<br>HIDE_PHP_VERSION-如果定义，则将隐藏php版本（expose_php = Off）。设置为任何值（例如HIDE_PHP_VERSION = true）。<br>UPLOAD_LIMIT -如果设置，将覆盖apache和php-fpm的默认值（默认值为2048 kb）<br>PMA_CONFIG_BASE64 -如果设置，将使用变量的base64解码内容覆盖默认的config.inc.php<br>PMA_USER_CONFIG_BASE64 -如果设置，将使用变量的base64解码内容覆盖默认的config.user.inc.php  </p>
<h1 id="phpmyadmin外链数据库或切换端口"><a href="#phpmyadmin外链数据库或切换端口" class="headerlink" title="phpmyadmin外链数据库或切换端口"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/27/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/#phpmyadmin%E5%A4%96%E9%93%BE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%88%96%E5%88%87%E6%8D%A2%E7%AB%AF%E5%8F%A3"></a>phpmyadmin外链数据库或切换端口</h1><p>1.修改phpmyadmin目录中libraries文件夹下的config.default.php文件<br>2.查找[‘Servers’][$i][‘host’]= xxx，改成所需的地址；<br>查找[‘Servers’][$i][‘port’]= xxx，改成所需的端口；<br>查找[‘Servers’][$i][‘user’]= xxx，改成所需的用户；<br>查找[‘Servers’][$i][‘password’]= xxx，改成所需的用户；</p>
<h1 id="wordpress配置文件"><a href="#wordpress配置文件" class="headerlink" title="wordpress配置文件"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/27/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/#wordpress%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a>wordpress配置文件</h1><p>wp-config.php</p>
<h1 id="修改最大上传文件大小限制"><a href="#修改最大上传文件大小限制" class="headerlink" title="修改最大上传文件大小限制"></a><a target="_blank" rel="noopener" href="https://wishzone.ltd/2023/08/27/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/#%E4%BF%AE%E6%94%B9%E6%9C%80%E5%A4%A7%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6"></a>修改最大上传文件大小限制</h1><p>可通过修改.htaccess文件完成<br>1、wordpress根目录下（/var/www/html）找到.htaccess文件<br>2、打开.htaccess文件并在module中间添加以下代码：<br>php_value upload_max_filesize 100M<br>php_value post_max_size 100M<br>将“100M”替换为您需要的大小。<br>3、保存并关闭.htaccess文件。</p>
<h2 id="服务器启动"><a href="#服务器启动" class="headerlink" title="服务器启动"></a>服务器启动</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MYSQL:</span><br><span class="line">docker run -d -p 3123:3306 --name=mysql --restart=always -e MYSQL_ROOT_PASSWORD=123456 wishzone/mysql docker-entrypoint.sh mysqld</span><br><span class="line">COMMAND:</span><br><span class="line">docker-entrypoint.sh mysqld</span><br><span class="line"></span><br><span class="line">PHPMYADMIN:</span><br><span class="line">sudo docker run --restart=always --name=myadmin -d -e PMA_ARBITRARY=1 -p 8080:80 wishzone/phpmyadmin /docker-entrypoint.sh apache2-foreground</span><br><span class="line">COMMAND:</span><br><span class="line">/docker-entrypoint.sh apache2-foreground</span><br><span class="line">IP:</span><br><span class="line">172.17.0.1:3123</span><br><span class="line"></span><br><span class="line">WORDPRESS:</span><br><span class="line">docker run -d -p 8088:80 --name=wordpress --restart=always --link mysql:mysql wishzone/wordpress docker-entrypoint.sh apache2-foreground</span><br><span class="line">COMMAND:</span><br><span class="line">docker-entrypoint.sh apache2-foreground</span><br></pre></td></tr></table></figure>
<h2 id="导入wordpress的idb文件到mysql"><a href="#导入wordpress的idb文件到mysql" class="headerlink" title="导入wordpress的idb文件到mysql"></a>导入wordpress的idb文件到mysql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bashmysql -uroot -pUSE wordpress;ALTER TABLE wp_commentmeta DISCARD TABLESPACE;ALTER TABLE wp_comments DISCARD TABLESPACE;ALTER TABLE wp_links DISCARD TABLESPACE;ALTER TABLE wp_options DISCARD TABLESPACE;ALTER TABLE wp_postmeta DISCARD TABLESPACE;ALTER TABLE wp_posts DISCARD TABLESPACE;ALTER TABLE wp_termmeta DISCARD TABLESPACE;ALTER TABLE wp_term_relationships DISCARD TABLESPACE;ALTER TABLE wp_terms DISCARD TABLESPACE;ALTER TABLE wp_term_taxonomy DISCARD TABLESPACE;ALTER TABLE wp_usermeta DISCARD TABLESPACE;ALTER TABLE wp_users DISCARD TABLESPACE;exitrm -rf /var/lib/mysql/wordpressexitdocker cp ~/wordpress mysql:/var/lib/mysqldocker exec -it mysql bashchown mysql:mysql /var/lib/mysql/wordpress/*mysql -uroot -pUSE wordpress;ALTER TABLE wp_commentmeta IMPORT TABLESPACE;ALTER TABLE wp_comments IMPORT TABLESPACE;ALTER TABLE wp_links IMPORT TABLESPACE;ALTER TABLE wp_options IMPORT TABLESPACE;ALTER TABLE wp_postmeta IMPORT TABLESPACE;ALTER TABLE wp_posts IMPORT TABLESPACE;ALTER TABLE wp_termmeta IMPORT TABLESPACE;ALTER TABLE wp_term_relationships IMPORT TABLESPACE;ALTER TABLE wp_terms IMPORT TABLESPACE;ALTER TABLE wp_term_taxonomy IMPORT TABLESPACE;ALTER TABLE wp_usermeta IMPORT TABLESPACE;ALTER TABLE wp_users IMPORT TABLESPACE;exitexit</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wishzone"
      src="/images/android-chrome-320x320.png">
  <p class="site-author-name" itemprop="name">Wishzone</p>
  <div class="site-description" itemprop="description">该网站仅为机械移植</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wishzone</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="true"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

  


    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
